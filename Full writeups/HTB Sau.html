<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Penetration Testing Report - Sau</title>
    <style>
        /* --- Universal Styles for Screen and Print --- */
        body {
            background-color: #0a4b63; /* Dark Teal Background */
            color: #f0f0f0; /* Off-white text for readability */
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 0;
            /* ** Crucial for forcing background colors in print ** */
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
        }
        .container {
            max-width: 900px;
            margin: 40px auto;
            padding: 20px 40px;
            background-color: #0c5975;
            border-radius: 8px;
            box-shadow: 0 0 15px rgba(0,0,0,0.5);
        }
        h1, h2, h3, h4 {
            color: #ffffff;
            border-bottom: 1px solid #2a9d8f;
            padding-bottom: 10px;
        }
        h1 {
            text-align: center;
            font-size: 2.5em;
            padding: 20px 0;
            border-top: 3px solid #93c47d; /* Green accent line */
            border-bottom: 3px solid #93c47d; /* Green accent line */
            margin-bottom: 5px;
        }
        h2.subtitle {
             text-align: center;
             font-size: 1.8em;
             border: none;
             margin-top: 0;
             margin-bottom: 5px;
        }
        h3.report-meta {
            text-align: center;
            font-size: 1.2em;
            border: none;
            margin-top: 0;
            margin-bottom: 5px;
        }
        hr {
            border: 0;
            height: 1px;
            background-color: #2a9d8f;
            margin: 30px 0;
        }
        .confidential {
            text-align: center;
            margin: 20px 0;
        }
        .confidential strong {
            font-size: 1.1em;
        }
        .confidential em {
            font-size: 0.9em;
            color: #cccccc;
        }
        a {
            color: #93c47d; /* Green accent for links */
            text-decoration: none;
        }
        a:hover {
            text-decoration: underline;
        }
        ul, ol {
            padding-left: 20px;
        }
        li {
            margin-bottom: 10px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 25px 0;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border: 1px solid #1a7469;
        }
        thead {
            background-color: #93c47d; /* Green accent for table headers */
            color: #0a4b63;
            /* ** Crucial for forcing background colors in print ** */
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
        }
        thead th {
             font-weight: bold;
        }
        tbody tr:nth-child(even) {
            background-color: #0a4b63; /* Striped rows */
        }
        pre {
            background-color: #002b36; /* Darker background for code */
            color: #cddc39; /* Lime green text for code */
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            border: 1px solid #1a7469;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        code {
            font-family: 'Courier New', Courier, monospace;
        }
        .footer {
             text-align: center;
             margin-top: 40px;
             font-style: italic;
             color: #cccccc;
        }
        
        /* This rule helps control the margins set by the browser's print function */
        @page {
            margin: 0.75in;
        }

    </style>
</head>
<body>

    <div class="container">

        <h1>CAPTURE THE FLAG PENETRATION TESTING</h1>
        <h2 class="subtitle">Report of Findings: Sau</h2>
        <h3 class="report-meta">Date: May, 04 2025</h3>
        <h3 class="report-meta">Version: 1.0</h3>

        <div class="confidential">
            <strong>CONFIDENTIAL</strong><br>
            <em>For educational and training purposes only</em>
        </div>

        <hr>
        
        <h2 id="table-of-contents">TABLE OF CONTENTS</h2>
        <ol>
            <li><a href="#executive-summary">Executive Summary</a></li>
            <li><a href="#technical-summary">Technical Summary</a></li>
            <li><a href="#detailed-findings">Detailed Technical Findings</a></li>
            <li><a href="#attack-timeline">Attack Timeline</a></li>
            <li><a href="#port-scan">Port Scan Results</a></li>
            <li><a href="#remediation">Remediation Recommendations</a></li>
            <li><a href="#evidence">Evidence Files</a></li>
            <li><a href="#conclusion">Conclusion</a></li>
        </ol>

        <hr>

        <h2 id="executive-summary">EXECUTIVE SUMMARY</h2>
        <p>This report details the findings from a penetration test conducted on the HTB Sau machine (10.10.11.224). The assessment uncovered a chain of high-risk vulnerabilities that enabled a full system compromise. The attack path began with a Server-Side Request Forgery (SSRF) vulnerability in the "Request Baskets" service (CVE-2023-27163), which was used to access an internal service. This led to the exploitation of an OS Command Injection vulnerability in "Maltrail" v0.53. This flaw provided initial access as a low-privilege user. Finally, privilege escalation was achieved by exploiting a known vulnerability in `systemctl` (CVE-2023-26604), which was accessible via a misconfigured sudo rule, leading to full root access.</p>
        
        <h3>Key Findings Summary</h3>
        <ul>
            <li><strong>3 high-risk vulnerabilities</strong> chained for complete system compromise.</li>
            <li><strong>Server-Side Request Forgery (SSRF)</strong> in Request Baskets v1.2.1 (CVE-2023-27163).</li>
            <li><strong>Unauthenticated OS Command Injection</strong> in Maltrail v0.53.</li>
            <li><strong>Privilege Escalation</strong> via a flawed `sudo` rule and a `systemctl` vulnerability (CVE-2023-26604).</li>
        </ul>

        <h3>Risk Level: HIGH</h3>
        <p>The system is exposed to a high risk of compromise. The combination of a public-facing SSRF, a command injection flaw in an internal service, and a known privilege escalation vulnerability in a core system utility provides a clear and effective path for an external attacker to gain full administrative control.</p>

        <hr>

        <h2 id="technical-summary">TECHNICAL SUMMARY</h2>
        
        <h3>Target Information</h3>
        <ul>
            <li><strong>Target IP:</strong> 10.10.11.224</li>
            <li><strong>Operating System:</strong> Ubuntu Linux</li>
            <li><strong>Hostname:</strong> sau</li>
        </ul>

        <h3>Attack Vector Summary</h3>
        <ol>
            <li><strong>Initial Access:</strong> The "Request Baskets" service on port 55555 was found to be vulnerable to SSRF (CVE-2023-27163). This was exploited to forward requests to an internal Maltrail service. The login page of the Maltrail service was vulnerable to unauthenticated OS command injection in the `username` parameter. A reverse shell payload was injected, resulting in a shell as the `puma` user.</li>
            <li><strong>Privilege Escalation:</strong> The `puma` user was found to have passwordless `sudo` access to run `systemctl status trail.service`. The `systemctl` command in the installed version of `systemd` was vulnerable to CVE-2023-26604, which allows for privilege escalation by escaping the `less` pager that `systemctl` invokes. By manipulating the terminal size and running the command, an interactive root shell was obtained.</li>
        </ol>

        <hr>

        <h2 id="detailed-findings">DETAILED TECHNICAL FINDINGS</h2>

        <h3>Finding 1: Server-Side Request Forgery in Request Baskets (CVE-2023-27163)</h3>
        <p><strong>Severity:</strong> HIGH<br>
        <strong>CVSS Score:</strong> 8.6<br>
        <strong>CWE:</strong> CWE-918 (Server-Side Request Forgery)</p>
        <p><strong>Description:</strong><br>
        The "Request Baskets" application, version 1.2.1, running on port 55555 is vulnerable to CVE-2023-27163. An attacker can create a new basket and configure a "forward URL" that points to an internal service. When a request is sent to this basket, the application forwards the request to the specified internal URL. This was used to pivot and interact with the internal-only Maltrail service.</p>
        <p><strong>Technical Details:</strong></p>
        <ul>
            <li><strong>Vulnerable Service:</strong> Request Baskets v1.2.1</li>
            <li><strong>Exploitation:</strong> A public exploit script was used to configure a basket to forward requests to `http://127.0.0.1:8080`, the address of the internal Maltrail service.</li>
        </ul>
        <p><strong>Impact:</strong> This SSRF vulnerability provided the necessary pivot to access an otherwise unreachable internal service, which was the key to gaining the initial foothold on the system.</p>

        <h3>Finding 2: Unauthenticated OS Command Injection in Maltrail v0.53</h3>
        <p><strong>Severity:</strong> HIGH<br>
        <strong>CVSS Score:</strong> 8.8<br>
        <strong>CWE:</strong> CWE-78 (OS Command Injection)</p>
        <p><strong>Description:</strong><br>
        The Maltrail service, version 0.53, accessible via the SSRF pivot, is vulnerable to an unauthenticated OS command injection vulnerability. The `username` parameter on the login page is not properly sanitized before being passed to a `subprocess.check_output()` function on the backend. An attacker can inject arbitrary shell commands into this parameter, which are then executed by the server.</p>
        <p><strong>Technical Details:</strong></p>
        <ul>
            <li><strong>Vulnerable Service:</strong> Maltrail v0.53</li>
            <li><strong>Vulnerable Parameter:</strong> `username` on the `/login` page.</li>
        </ul>
        <p><strong>Impact:</strong> This vulnerability allows an unauthenticated attacker (with the ability to reach the service) to execute arbitrary commands as the `puma` user, leading to a reverse shell and initial system access.</p>

        <h3>Finding 3: Privilege Escalation via systemctl and `less` (CVE-2023-26604)</h3>
        <p><strong>Severity:</strong> HIGH<br>
        <strong>CVSS Score:</strong> 7.8<br>
        <strong>CWE:</strong> CWE-269 (Improper Privilege Management)</p>
        <p><strong>Description:</strong><br>
        The user `puma` has passwordless `sudo` privileges to execute `systemctl status trail.service`. The version of `systemd` (v245) on the system is vulnerable to CVE-2023-26604. This vulnerability allows an attacker to escape the `less` pager, which `systemctl` uses to display output, and gain an interactive shell. Because the `systemctl` command was run via `sudo`, the resulting shell inherits root privileges.</p>
        <p><strong>Technical Details:</strong></p>
        <ul>
            <li><strong>Vulnerable Component:</strong> Sudoers rule for `systemctl` and `systemd` version 245.</li>
            <li><strong>Exploitation:</strong> By setting the terminal window to a small size and running the sudo command, the `less` pager is invoked. Typing `!/bin/bash` within the pager spawns a root shell.</li>
        </ul>
        <p><strong>Impact:</strong> This misconfiguration and vulnerability provide a direct path for a low-privileged user to escalate to root, resulting in a full system compromise.</p>

        <hr>

        <h2 id="attack-timeline">ATTACK TIMELINE</h2>
        
        <h3>Phase 1: Reconnaissance</h3>
        <ul>
            <li><strong>Scanning:</strong> Identified SSH on port 22 and a "Request Baskets" service on port 55555.</li>
            <li><strong>Vulnerability Identification:</strong> Identified the Request Baskets version as 1.2.1, known to be vulnerable to SSRF (CVE-2023-27163).</li>
        </ul>

        <h3>Phase 2: Initial Access</h3>
        <ul>
            <li><strong>SSRF Exploitation:</strong> Used an exploit for CVE-2023-27163 to create a proxy basket forwarding traffic to the internal Maltrail service on port 8080.</li>
            <li><strong>Command Injection:</strong> Exploited the command injection vulnerability in Maltrail's login page by sending a reverse shell payload in the `username` parameter through the proxy basket.</li>
            <li><strong>Foothold Gained:</strong> Received a shell as the `puma` user and retrieved the user flag.</li>
        </ul>
        
        <h3>Phase 3: Privilege Escalation</h3>
        <ul>
            <li><strong>Sudo Enumeration:</strong> Ran `sudo -l` and identified the passwordless permission to run `systemctl status trail.service`.</li>
            <li><strong>Vulnerability Exploitation:</strong> Resized the terminal, ran the sudo command to invoke the `less` pager, and escaped to a shell using the `!/bin/bash` command.</li>
            <li><strong>Root Access:</strong> Gained an interactive root shell and retrieved the root flag.</li>
        </ul>

        <hr>
        
        <h2 id="port-scan">PORT SCAN RESULTS</h2>
        <h3>TCP Port Scan</h3>
        <pre><code>PORT      STATE SERVICE
22/tcp    open  ssh
55555/tcp open  unknown (Request Baskets)</code></pre>

        <hr>
        
        <h2 id="remediation">REMEDIATION RECOMMENDATIONS</h2>
        
        <h3>HIGH PRIORITY</h3>
        <ol>
            <li><strong>Patch or Replace Request Baskets:</strong> Immediately update the Request Baskets service to a version that patches CVE-2023-27163, or replace it with a non-vulnerable alternative. Public-facing services with known SSRF vulnerabilities pose a severe risk.</li>
            <li><strong>Patch Maltrail:</strong> Although internal, the Maltrail service must be updated to a version that is not vulnerable to OS command injection (v0.54 or later).</li>
            <li><strong>Update systemd and Harden Sudo Rules:</strong> Update the `systemd` package to a version that patches CVE-2023-26604. Additionally, review all sudo rules. Granting access to interactive commands like `systemctl status` is risky and should be avoided.</li>
        </ol>

        <hr>

        <h2 id="evidence">EVIDENCE FILES</h2>
        
        <h3>User Flag</h3>
        <ul>
            <li><strong>Location:</strong> /home/puma/user.txt</li>
            <li><strong>Value:</strong> 8df2d3d5c02da1bdda0564b230c92fbc</li>
        </ul>

        <h3>Root Flag</h3>
        <ul>
            <li><strong>Location:</strong> /root/root.txt</li>
            <li><strong>Value:</strong> 2c52b8708b5cd69114cdaed9e797fa7c</li>
        </ul>

        <h3>Key Artifacts</h3>
        <ul>
            <li><strong>SSRF Vulnerability:</strong> CVE-2023-27163 in Request Baskets</li>
            <li><strong>Command Injection:</strong> Maltrail v0.53 `username` parameter</li>
            <li><strong>Privilege Escalation Vulnerability:</strong> CVE-2023-26604 in `systemd`</li>
        </ul>

        <hr>

        <h2 id="conclusion">CONCLUSION</h2>
        <p>The Sau machine was compromised through a chain of high-risk vulnerabilities that highlight the danger of exposing outdated services and the importance of securing internal applications. The initial SSRF flaw served as a gateway into the internal network, bypassing perimeter defenses. This access was then leveraged to exploit a critical command injection bug in an internal tool. The final escalation was made possible by an insecure sudo configuration combined with a known vulnerability in a core system utility. This engagement demonstrates that a secure perimeter is not enough; internal services must be kept up-to-date and configured with the principle of least privilege in mind.</p>
        
        <p><strong>Business Risk:</strong> HIGH - A public-facing vulnerability allows an attacker to pivot into the internal network and exploit further vulnerabilities to gain full administrative control. This represents a complete loss of confidentiality, integrity, and availability for the system.</p>
        <p><strong>Technical Risk:</strong> The combination of SSRF, command injection, and a known privilege escalation vulnerability creates a reliable and effective path for an external attacker to achieve root access.</p>
        
        <hr>

        <div class="footer">
            <p><strong>Report prepared by:</strong> Security Assessment Team<br>
            <strong>Date:</strong> May, 04 2025</p>
            <p>CONFIDENTIAL - For educational purposes only</p>
        </div>

    </div>

</body>
</html>