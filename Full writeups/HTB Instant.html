<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Penetration Testing Report - Instant</title>
    <style>
        /* --- Universal Styles for Screen and Print --- */
        body {
            background-color: #0a4b63; /* Dark Teal Background */
            color: #f0f0f0; /* Off-white text for readability */
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 0;
            /* ** Crucial for forcing background colors in print ** */
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
        }
        .container {
            max-width: 900px;
            margin: 40px auto;
            padding: 20px 40px;
            background-color: #0c5975;
            border-radius: 8px;
            box-shadow: 0 0 15px rgba(0,0,0,0.5);
        }
        h1, h2, h3, h4 {
            color: #ffffff;
            border-bottom: 1px solid #2a9d8f;
            padding-bottom: 10px;
        }
        h1 {
            text-align: center;
            font-size: 2.5em;
            padding: 20px 0;
            border-top: 3px solid #93c47d; /* Green accent line */
            border-bottom: 3px solid #93c47d; /* Green accent line */
            margin-bottom: 5px;
        }
        h2.subtitle {
             text-align: center;
             font-size: 1.8em;
             border: none;
             margin-top: 0;
             margin-bottom: 5px;
        }
        h3.report-meta {
            text-align: center;
            font-size: 1.2em;
            border: none;
            margin-top: 0;
            margin-bottom: 5px;
        }
        hr {
            border: 0;
            height: 1px;
            background-color: #2a9d8f;
            margin: 30px 0;
        }
        .confidential {
            text-align: center;
            margin: 20px 0;
        }
        .confidential strong {
            font-size: 1.1em;
        }
        .confidential em {
            font-size: 0.9em;
            color: #cccccc;
        }
        a {
            color: #93c47d; /* Green accent for links */
            text-decoration: none;
        }
        a:hover {
            text-decoration: underline;
        }
        ul, ol {
            padding-left: 20px;
        }
        li {
            margin-bottom: 10px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 25px 0;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border: 1px solid #1a7469;
        }
        thead {
            background-color: #93c47d; /* Green accent for table headers */
            color: #0a4b63;
            /* ** Crucial for forcing background colors in print ** */
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
        }
        thead th {
             font-weight: bold;
        }
        tbody tr:nth-child(even) {
            background-color: #0a4b63; /* Striped rows */
        }
        pre {
            background-color: #002b36; /* Darker background for code */
            color: #cddc39; /* Lime green text for code */
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            border: 1px solid #1a7469;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        code {
            font-family: 'Courier New', Courier, monospace;
        }
        .footer {
             text-align: center;
             margin-top: 40px;
             font-style: italic;
             color: #cccccc;
        }
        
        /* This rule helps control the margins set by the browser's print function */
        @page {
            margin: 0.75in;
        }

    </style>
</head>
<body>

    <div class="container">

        <h1>CAPTURE THE FLAG PENETRATION TESTING</h1>
        <h2 class="subtitle">Report of Findings: Instant</h2>
        <h3 class="report-meta">Date: January 9, 2025</h3>
        <h3 class="report-meta">Version: 1.0</h3>

        <div class="confidential">
            <strong>CONFIDENTIAL</strong><br>
            <em>For educational and training purposes only</em>
        </div>

        <hr>
        
        <h2 id="table-of-contents">TABLE OF CONTENTS</h2>
        <ol>
            <li><a href="#executive-summary">Executive Summary</a></li>
            <li><a href="#technical-summary">Technical Summary</a></li>
            <li><a href="#detailed-findings">Detailed Technical Findings</a></li>
            <li><a href="#attack-timeline">Attack Timeline</a></li>
            <li><a href="#remediation">Remediation Recommendations</a></li>
            <li><a href="#evidence">Evidence Files</a></li>
            <li><a href="#conclusion">Conclusion</a></li>
        </ol>

        <hr>

        <h2 id="executive-summary">EXECUTIVE SUMMARY</h2>
        <p>This report details a penetration test conducted on the HTB Instant machine (10.10.11.37). The assessment revealed a chain of critical vulnerabilities starting with the analysis of a mobile application (`.apk`). This analysis led to the discovery of a hardcoded administrator JWT and a hidden API endpoint. The API was found to be vulnerable to Local File Inclusion (LFI), which was exploited to steal a user's private SSH key for initial access. Post-exploitation, an insecurely stored and weakly encrypted backup file was discovered, which contained the root user's password. This sequence of flaws allowed an unauthenticated attacker to escalate privileges and achieve a full system compromise.</p>
        
        <h3>Key Findings Summary</h3>
        <ul>
            <li><strong>3 critical vulnerabilities</strong> were chained to achieve root access.</li>
            <li><strong>Complete system compromise</strong> from unauthenticated to root.</li>
            <li><strong>Credential Disclosure</strong> via a hardcoded administrator JWT in a mobile application.</li>
            <li><strong>Local File Inclusion (LFI)</strong> in an authenticated API endpoint, leading to SSH key theft.</li>
            <li><strong>Insufficiently Protected Credentials</strong> in a weakly encrypted Solar-PuTTY backup file, exposing the root password.</li>
        </ul>

        <h3>Risk Level: CRITICAL</h3>
        <p>The system is exposed to a high-impact, low-complexity attack path. The combination of insecure secret storage in a client-side application, a classic web vulnerability (LFI), and poor backup security practices creates a direct and repeatable method for an external attacker to gain full administrative control.</p>

        <hr>

        <h2 id="technical-summary">TECHNICAL SUMMARY</h2>
        
        <h3>Target Information</h3>
        <ul>
            <li><strong>Target IP:</strong> 10.10.11.37</li>
            <li><strong>Attacker IP:</strong> 10.10.14.253</li>
            <li><strong>Hostname:</strong> instant.htb, mywalletv1.instant.htb, swagger-ui.instant.htb</li>
            <li><strong>Operating System:</strong> Ubuntu 24.04.1 LTS</li>
        </ul>

        <h3>Attack Vector Summary</h3>
        <ol>
            <li><strong>Initial Access:</strong> Decompiling an Android application (`instant.apk`) revealed a hardcoded admin JWT and multiple API subdomains. The JWT was used to authenticate to an API endpoint on the `swagger-ui.instant.htb` subdomain. A Local File Inclusion (LFI) vulnerability was then exploited to read the private SSH key of the user `shirohige`, which was used to log into the system.</li>
            <li><strong>Privilege Escalation:</strong> A Solar-PuTTY session backup file (`session.dat`) was discovered in the `/opt/backup` directory. The file's encryption password was cracked using a wordlist, revealing the stored credentials for the `root` user. The `su` command was then used with this password to gain full root access.</li>
        </ol>

        <hr>

        <h2 id="detailed-findings">DETAILED TECHNICAL FINDINGS</h2>

        <h3>Finding 1: Hardcoded Administrator JWT in Mobile Application</h3>
        <p><strong>Severity:</strong> CRITICAL<br>
        <strong>CVSS Score:</strong> 9.1<br>
        <strong>CWE:</strong> CWE-798 (Use of Hard-coded Credentials)</p>
        <p><strong>Description:</strong><br>
        The `instant.apk` mobile application, when decompiled and analyzed, was found to contain a hardcoded JSON Web Token (JWT) within its source code. This token corresponds to a user with an "Admin" role and has an extremely long expiration date (valid until the year 3024). This static secret provides any party with access to the APK with long-term administrative privileges to the associated API.</p>
        <p><strong>Technical Details:</strong></p>
        <ul>
            <li><strong>Location:</strong> Decompiled `smali` files from `instant.apk`.</li>
            <li><strong>Information Disclosed:</strong> A non-expiring JWT for an administrative user.</li>
        </ul>
        <p><strong>Impact:</strong> This vulnerability provides a complete bypass of the API's authentication mechanism for administrative endpoints, directly enabling the subsequent LFI attack.</p>

        <h3>Finding 2: Authenticated Local File Inclusion (LFI)</h3>
        <p><strong>Severity:</strong> HIGH<br>
        <strong>CVSS Score:</strong> 7.7<br>
        <strong>CWE:</strong> CWE-22 (Improper Limitation of a Pathname to a Restricted Directory - 'Path Traversal')</p>
        <p><strong>Description:</strong><br>
        The API, accessible via the `swagger-ui.instant.htb` subdomain, has an administrative endpoint `/api/v1/admin/read/log` that is vulnerable to Local File Inclusion. This endpoint is intended to read log files from `/home/shirohige/logs/`. However, it fails to sanitize the `log_file_name` parameter, allowing an attacker to use path traversal sequences (`../`) to read arbitrary files from the filesystem with the permissions of the web server process.</p>
        <p><strong>Technical Details:</strong></p>
        <ul>
            <li><strong>Vulnerable Endpoint:</strong> `/api/v1/admin/read/log`</li>
            <li><strong>Vulnerable Parameter:</strong> `log_file_name`</li>
        </ul>
        <p><strong>Evidence:</strong><br>The vulnerability was exploited using the hardcoded admin JWT to read the user's private SSH key:</p>
        <pre><code>GET /api/v1/admin/read/log?log_file_name=../../.ssh/id_rsa HTTP/1.1
Host: swagger-ui.instant.htb
Authorization: Bearer eyJhbGci...Z6rYA</code></pre>
        <p><strong>Impact:</strong> This vulnerability allowed the attacker to steal a valid private SSH key, which granted them direct shell access to the system as the user `shirohige`.</p>

        <h3>Finding 3: Insufficiently Protected Credentials in Backup File</h3>
        <p><strong>Severity:</strong> HIGH<br>
        <strong>CVSS Score:</strong> 7.8<br>
        <strong>CWE:</strong> CWE-312 (Cleartext Storage of Sensitive Information)</p>
        <p><strong>Description:</strong><br>
        A Solar-PuTTY session backup file, `session.dat`, was found in the world-readable `/opt/backup` directory. This file contained stored credentials, including the password for the `root` user. While the file was password-protected, the password used (`estrella`) was weak and easily cracked using a common wordlist. The credentials within were not further encrypted.</p>
        <p><strong>Technical Details:</strong></p>
        <ul>
            <li><strong>Location:</strong> `/opt/backup/session.dat`</li>
            <li><strong>Weakness:</strong> Use of a weak, guessable password for file encryption.</li>
            <li><strong>Credentials Found:</strong> `root`:`12**24nzC!r0c%q12`</li>
        </ul>
        <p><strong>Impact:</strong> The insecure storage and weak protection of this backup file directly exposed the `root` password, allowing for a full privilege escalation and complete compromise of the system.</p>

        <hr>

        <h2 id="attack-timeline">ATTACK TIMELINE</h2>
        
        <h3>Phase 1: Reconnaissance & Initial Discovery</h3>
        <ul>
            <li><strong>Mobile App Analysis:</strong> Decompiled `instant.apk` using `apktool`.</li>
            <li><strong>Information Disclosure:</strong> Discovered hardcoded API subdomains (`mywalletv1.instant.htb`, `swagger-ui.instant.htb`) and a static admin JWT.</li>
        </ul>

        <h3>Phase 2: Initial Access</h3>
        <ul>
            <li><strong>API Enumeration:</strong> Explored the API using the Swagger UI interface and the admin JWT.</li>
            <li><strong>LFI Exploitation:</strong> Identified and exploited a path traversal vulnerability in the log viewer endpoint to read `/home/shirohige/.ssh/id_rsa`.</li>
            <li><strong>SSH Access:</strong> Used the stolen private key to log in as the `shirohige` user and retrieve the user flag.</li>
        </ul>
        
        <h3>Phase 3: Privilege Escalation</h3>
        <ul>
            <li><strong>Internal Enumeration:</strong> Discovered the `session.dat` backup file in `/opt/backup`.</li>
            <li><strong>Credential Cracking:</strong> Used a decryption script and `rockyou.txt` to crack the backup file's password (`estrella`).</li>
            <li><strong>Credential Extraction:</strong> The decrypted file revealed the root password (`12**24nzC!r0c%q12`).</li>
            <li><strong>Root Access:</strong> Used `su` with the discovered password to gain a root shell and retrieve the root flag.</li>
        </ul>

        <hr>
        
        <h2 id="remediation">REMEDIATION RECOMMENDATIONS</h2>
        
        <h3>CRITICAL PRIORITY</h3>
        <ol>
            <li><strong>Remove Hardcoded Secrets:</strong> Immediately remove the hardcoded JWT from the Android application. Implement a secure authentication mechanism (e.g., OAuth2 with short-lived tokens) instead of relying on static, non-expiring secrets.</li>
            <li><strong>Sanitize Input for LFI:</strong> The `log_file_name` parameter must be strictly sanitized. Implement code to prevent path traversal sequences (`../`) and ensure that only files within the intended directory can be accessed.</li>
            <li><strong>Secure Backup Files:</strong> Immediately change the root password. Do not store sensitive backup files in world-readable locations. Enforce the use of strong, complex passwords for encrypting any backup files containing credentials.</li>
        </ol>

        <h3>HIGH PRIORITY</h3>
        <ol>
            <li><strong>API Security Review:</strong> Conduct a full security review of the API. All endpoints, especially administrative ones, should be protected by robust authentication and authorization controls.</li>
            <li><strong>Principle of Least Privilege:</strong> The web server process should run with the minimum privileges necessary and should not have access to sensitive user files like SSH keys.</li>
        </ol>

        <hr>

        <h2 id="evidence">EVIDENCE FILES</h2>
        
        <h3>User Flag</h3>
        <ul>
            <li><strong>Location:</strong> /home/shirohige/user.txt</li>
            <li><strong>Value:</strong> 2db2449cec555d22e9c41f2f38047ee0</li>
        </ul>

        <h3>Root Flag</h3>
        <ul>
            <li><strong>Location:</strong> /root/root.txt</li>
            <li><strong>Value:</strong> 4fd90141114509c88324b369ecc39041</li>
        </ul>

        <h3>Key Artifacts</h3>
        <ul>
            <li><strong>Hardcoded JWT:</strong> `eyJhbGci...Z6rYA`</li>
            <li><strong>LFI Payload:</strong> `../../.ssh/id_rsa`</li>
            <li><strong>Cracked Passwords:</strong> `estrella` (for backup file), `12**24nzC!r0c%q12` (for root)</li>
        </ul>

        <hr>

        <h2 id="conclusion">CONCLUSION</h2>
        <p>The Instant machine was compromised due to a series of fundamental security failures across different layers of the system. The practice of hardcoding a non-expiring administrative token in a client-side application provided a critical entry point. This was compounded by a classic LFI web vulnerability that allowed for the theft of SSH credentials. The final escalation to root was made possible by extremely poor backup security practices, where a file containing the root password was left in a public location with weak encryption. This engagement highlights the critical importance of securing every component of an application, from the mobile client to backend APIs and system administration procedures.</p>
        
        <p><strong>Business Risk:</strong> CRITICAL - The system is vulnerable to a complete takeover by an unauthenticated party who can obtain the mobile application. This could lead to a total loss of data confidentiality and integrity, service disruption, and the compromise of all user wallet information.</p>
        <p><strong>Technical Risk:</strong> A chain of high-impact vulnerabilities related to credential management and input validation creates a direct and reliable path for an attacker to achieve full administrative control of the system.</p>
        
        <hr>

        <div class="footer">
            <p><strong>Report prepared by:</strong> Security Assessment Team<br>
            <strong>Date:</strong> January 9, 2025</p>
            <p>CONFIDENTIAL - For educational purposes only</p>
        </div>

    </div>

</body>
</html>