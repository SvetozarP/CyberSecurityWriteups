<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Penetration Testing Report - Keeper</title>
    <style>
        /* --- Universal Styles for Screen and Print --- */
        body {
            background-color: #0a4b63; /* Dark Teal Background */
            color: #f0f0f0; /* Off-white text for readability */
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 0;
            /* ** Crucial for forcing background colors in print ** */
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
        }
        .container {
            max-width: 900px;
            margin: 40px auto;
            padding: 20px 40px;
            background-color: #0c5975;
            border-radius: 8px;
            box-shadow: 0 0 15px rgba(0,0,0,0.5);
        }
        h1, h2, h3, h4 {
            color: #ffffff;
            border-bottom: 1px solid #2a9d8f;
            padding-bottom: 10px;
        }
        h1 {
            text-align: center;
            font-size: 2.5em;
            padding: 20px 0;
            border-top: 3px solid #93c47d; /* Green accent line */
            border-bottom: 3px solid #93c47d; /* Green accent line */
            margin-bottom: 5px;
        }
        h2.subtitle {
             text-align: center;
             font-size: 1.8em;
             border: none;
             margin-top: 0;
             margin-bottom: 5px;
        }
        h3.report-meta {
            text-align: center;
            font-size: 1.2em;
            border: none;
            margin-top: 0;
            margin-bottom: 5px;
        }
        hr {
            border: 0;
            height: 1px;
            background-color: #2a9d8f;
            margin: 30px 0;
        }
        .confidential {
            text-align: center;
            margin: 20px 0;
        }
        .confidential strong {
            font-size: 1.1em;
        }
        .confidential em {
            font-size: 0.9em;
            color: #cccccc;
        }
        a {
            color: #93c47d; /* Green accent for links */
            text-decoration: none;
        }
        a:hover {
            text-decoration: underline;
        }
        ul, ol {
            padding-left: 20px;
        }
        li {
            margin-bottom: 10px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 25px 0;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border: 1px solid #1a7469;
        }
        thead {
            background-color: #93c47d; /* Green accent for table headers */
            color: #0a4b63;
            /* ** Crucial for forcing background colors in print ** */
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
        }
        thead th {
             font-weight: bold;
        }
        tbody tr:nth-child(even) {
            background-color: #0a4b63; /* Striped rows */
        }
        pre {
            background-color: #002b36; /* Darker background for code */
            color: #cddc39; /* Lime green text for code */
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            border: 1px solid #1a7469;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        code {
            font-family: 'Courier New', Courier, monospace;
        }
        .footer {
             text-align: center;
             margin-top: 40px;
             font-style: italic;
             color: #cccccc;
        }
        
        /* This rule helps control the margins set by the browser's print function */
        @page {
            margin: 0.75in;
        }

    </style>
</head>
<body>

    <div class="container">

        <h1>CAPTURE THE FLAG PENETRATION TESTING</h1>
        <h2 class="subtitle">Report of Findings: Keeper</h2>
        <h3 class="report-meta">Date: May 03, 2025</h3>
        <h3 class="report-meta">Version: 1.0</h3>

        <div class="confidential">
            <strong>CONFIDENTIAL</strong><br>
            <em>For educational and training purposes only</em>
        </div>

        <hr>
        
        <h2 id="table-of-contents">TABLE OF CONTENTS</h2>
        <ol>
            <li><a href="#executive-summary">Executive Summary</a></li>
            <li><a href="#technical-summary">Technical Summary</a></li>
            <li><a href="#detailed-findings">Detailed Technical Findings</a></li>
            <li><a href="#attack-timeline">Attack Timeline</a></li>
            <li><a href="#port-scan">Port Scan Results</a></li>
            <li><a href="#remediation">Remediation Recommendations</a></li>
            <li><a href="#evidence">Evidence Files</a></li>
            <li><a href="#conclusion">Conclusion</a></li>
        </ol>

        <hr>

        <h2 id="executive-summary">EXECUTIVE SUMMARY</h2>
        <p>This report documents the findings of a penetration test on the HTB Keeper machine (10.10.11.227). The assessment revealed a chain of vulnerabilities that began with the exploitation of default credentials on a Request Tracker (RT) instance. This initial access led to the discovery of user credentials for SSH access. Post-exploitation, a KeePass memory dump was analyzed, and a known vulnerability (CVE-2023-32784) was leveraged to recover the master password for a KeePass database. This database contained the private SSH key for the root user, which was used to gain full administrative control, leading to a complete system compromise.</p>
        
        <h3>Key Findings Summary</h3>
        <ul>
            <li><strong>3 critical vulnerabilities</strong> were chained to achieve root access.</li>
            <li><strong>Complete system compromise</strong> from unauthenticated to root.</li>
            <li><strong>Use of Default Credentials</strong> on a public-facing Request Tracker (RT) instance.</li>
            <li><strong>KeePass Master Password Recovery (CVE-2023-32784)</strong> from a memory dump.</li>
            <li><strong>Insecure Storage of Root SSH Key</strong> within a KeePass database.</li>
        </ul>

        <h3>Risk Level: CRITICAL</h3>
        <p>The system is critically vulnerable due to a series of poor security practices. The use of default credentials for a public-facing application provided the initial entry point, while insecure credential management practices and a failure to patch known vulnerabilities allowed for a straightforward escalation to full administrative control.</p>

        <hr>

        <h2 id="technical-summary">TECHNICAL SUMMARY</h2>
        
        <h3>Target Information</h3>
        <ul>
            <li><strong>Target IP:</strong> 10.10.11.227</li>
            <li><strong>Attacker IP:</strong> 10.10.14.14</li>
            <li><strong>Hostnames:</strong> keeper.htb, tickets.keeper.htb</li>
            <li><strong>Operating System:</strong> Ubuntu 22.04.3 LTS</li>
        </ul>

        <h3>Attack Vector Summary</h3>
        <ol>
            <li><strong>Initial Access:</strong> A Request Tracker (RT) instance on the `tickets.keeper.htb` subdomain was accessible with default credentials (`root`:`password`). This provided access to the ticketing system, where credentials for the user `lnorgaard` (`Welcome2023!`) were discovered. These were used to log in via SSH.</li>
            <li><strong>Privilege Escalation (User to Root):</strong> As the user `lnorgaard`, a KeePass database (`passcodes.kdbx`) and a corresponding memory dump were found. The KeePass instance was vulnerable to CVE-2023-32784, which allowed the reconstruction of the master password (`rødgrød med fløde`) from the memory dump. The KeePass database was then unlocked, revealing a PuTTY private key for the `root` user. This key was converted and used to gain root access via SSH.</li>
        </ol>

        <hr>

        <h2 id="detailed-findings">DETAILED TECHNICAL FINDINGS</h2>

        <h3>Finding 1: Use of Default Credentials in Request Tracker</h3>
        <p><strong>Severity:</strong> CRITICAL<br>
        <strong>CVSS Score:</strong> 9.8<br>
        <strong>CWE:</strong> CWE-1392 (Use of Default Credentials)</p>
        <p><strong>Description:</strong><br>
        The Request Tracker (RT) instance running on `http://tickets.keeper.htb/rt/` was configured with the default administrator credentials. An attacker was able to authenticate as the `root` user with the password `password`. This granted full administrative control over the ticketing application.</p>
        <p><strong>Technical Details:</strong></p>
        <ul>
            <li><strong>Vulnerable Application:</strong> Request Tracker 4.4.4</li>
            <li><strong>Default Credentials:</strong> `root`:`password`</li>
        </ul>
        <p><strong>Impact:</strong> This vulnerability provided the initial foothold, allowing the attacker to access sensitive information within the application, including credentials for other users, which facilitated the next stage of the attack.</p>

        <h3>Finding 2: KeePass Master Password Recovery from Memory Dump (CVE-2023-32784)</h3>
        <p><strong>Severity:</strong> HIGH<br>
        <strong>CVSS Score:</strong> 7.8<br>
        <strong>CWE:</strong> CWE-316 (Cleartext Storage of Sensitive Information in Memory)</p>
        <p><strong>Description:</strong><br>
        After gaining user access, a memory dump of a running KeePass process was found. The version of KeePass was vulnerable to CVE-2023-32784, a flaw where plaintext fragments of the master password remain in memory. By analyzing the memory dump, an attacker can reconstruct the full master password, even for complex passwords that would be resistant to brute-force attacks.</p>
        <p><strong>Technical Details:</strong></p>
        <ul>
            <li><strong>Vulnerable Application:</strong> KeePass (version susceptible to CVE-2023-32784)</li>
            <li><strong>Exploitation Method:</strong> Analysis of memory dump to reconstruct password characters.</li>
            <li><strong>Recovered Master Password:</strong> `rødgrød med fløde`</li>
        </ul>
        <p><strong>Impact:</strong> This vulnerability allowed the attacker to bypass the primary security control of the KeePass password vault, leading to the exposure of all secrets stored within, including the root SSH key.</p>

        <h3>Finding 3: Insecure Storage of Root SSH Private Key</h3>
        <p><strong>Severity:</strong> CRITICAL<br>
        <strong>CVSS Score:</strong> 9.1<br>
        <strong>CWE:</strong> CWE-259 (Use of Hard-coded Password)</p>
        <p><strong>Description:</strong><br>
        The compromised KeePass database contained an entry for the `root` user which stored not only a password but also a full PuTTY-formatted private SSH key. Storing a highly sensitive credential like a root private key within a password manager, even a secure one, concentrates risk. Once the master password for the vault was compromised, the root key was immediately accessible.</p>
        <p><strong>Technical Details:</strong></p>
        <ul>
            <li><strong>Exposed Credential:</strong> Root user's private SSH key in PuTTY format.</li>
            <li><strong>Method of Compromise:</strong> Accessed via the compromised KeePass database.</li>
        </ul>
        <p><strong>Impact:</strong> The exposure of the root private key provided the attacker with direct, passwordless administrative access to the server, resulting in a complete system compromise.</p>

        <hr>

        <h2 id="attack-timeline">ATTACK TIMELINE</h2>
        
        <h3>Phase 1: Reconnaissance</h3>
        <ul>
            <li><strong>Scanning:</strong> Identified SSH (22) and HTTP (80) ports. Discovered the `tickets.keeper.htb` subdomain.</li>
            <li><strong>Application Discovery:</strong> Identified a Request Tracker (RT) 4.4.4 instance on the subdomain.</li>
        </ul>

        <h3>Phase 2: Initial Access</h3>
        <ul>
            <li><strong>Default Credential Abuse:</strong> Logged into the RT instance with `root`:`password`.</li>
            <li><strong>Credential Discovery:</strong> Found credentials for the user `lnorgaard` (`Welcome2023!`).</li>
            <li><strong>SSH Access:</strong> Logged into `keeper.htb` as `lnorgaard` via SSH.</li>
        </ul>
        
        <h3>Phase 3: Privilege Escalation</h3>
        <ul>
            <li><strong>Internal Enumeration:</strong> Found a KeePass database (`passcodes.kdbx`) and a memory dump file.</li>
            <li><strong>Vulnerability Exploitation:</strong> Used a tool for CVE-2023-32784 to recover the KeePass master password from the memory dump.</li>
            <li><strong>Credential Extraction:</strong> Unlocked the KeePass database and extracted the root user's password (`F4><3K0nd!`) and private SSH key.</li>
            <li><strong>Root Access:</strong> Converted the PuTTY key to OpenSSH format and used it to log in as `root` via SSH.</li>
        </ul>

        <hr>
        
        <h2 id="port-scan">PORT SCAN RESULTS</h2>
        <h3>TCP Port Scan</h3>
        <pre><code>PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 8.9p1 Ubuntu 3ubuntu0.3
80/tcp open  http    nginx 1.18.0 (Ubuntu)</code></pre>

        <hr>
        
        <h2 id="remediation">REMEDIATION RECOMMENDATIONS</h2>
        
        <h3>CRITICAL PRIORITY</h3>
        <ol>
            <li><strong>Change Default Credentials:</strong> Immediately change the default password for the `root` account on the Request Tracker instance. All default passwords on all applications should be changed upon installation.</li>
            <li><strong>Secure Root Credentials:</strong> The root password and SSH key must be changed immediately. Private keys for the root user should not be stored in password managers accessible by non-root users. Implement strict access controls and consider using a hardware security module (HSM) for such critical secrets.</li>
            <li><strong>Update KeePass:</strong> Update all instances of KeePass to a version that patches CVE-2023-32784 (version 2.54 or later) to prevent master password recovery from memory.</li>
        </ol>

        <h3>HIGH PRIORITY</h3>
        <ol>
            <li><strong>Credential Rotation:</strong> Change the password for the `lnorgaard` account and audit all other user accounts for weak or compromised credentials.</li>
            <li><strong>Security Awareness:</strong> Train users on the risks of storing highly privileged credentials (like root keys) in shared or user-level password vaults.</li>
        </ol>

        <hr>

        <h2 id="evidence">EVIDENCE FILES</h2>
        
        <h3>User Flag</h3>
        <ul>
            <li><strong>Location:</strong> /home/lnorgaard/user.txt</li>
            <li><strong>Value:</strong> a07f770dbd2f7833c66c7df6f6acf345</li>
        </ul>

        <h3>Root Flag</h3>
        <ul>
            <li><strong>Location:</strong> /root/root.txt</li>
            <li><strong>Value:</strong> 154dd38b3d372fbc086726e083e56911</li>
        </ul>

        <h3>Key Artifacts</h3>
        <ul>
            <li><strong>RT Credentials:</strong> `root`:`password`</li>
            <li><strong>User Credentials:</strong> `lnorgaard`:`Welcome2023!`</li>
            <li><strong>KeePass Master Password:</strong> `rødgrød med fløde`</li>
            <li><strong>Root Password:</strong> `F4><3K0nd!`</li>
            <li><strong>Privilege Escalation Vulnerability:</strong> CVE-2023-32784</li>
        </ul>

        <hr>

        <h2 id="conclusion">CONCLUSION</h2>
        <p>The Keeper machine was compromised due to a cascade of failures in basic security hygiene. The initial point of entry was a default password on a public application, a critical and easily preventable oversight. The subsequent privilege escalation path was enabled by insecure credential management practices and the failure to patch a known, high-severity vulnerability in a commonly used security tool (KeePass). This engagement underscores that even with strong tools like password managers, poor operational security practices can undermine their effectiveness and lead to a complete system compromise.</p>
        
        <p><strong>Business Risk:</strong> CRITICAL - The use of default credentials on a public-facing system provided a direct path for an attacker to gain access to internal data, which ultimately led to a full system takeover. This could result in a complete loss of data confidentiality, integrity, and availability.</p>
        <p><strong>Technical Risk:</strong> The combination of default credentials, a known software vulnerability (CVE-2023-32784), and the insecure storage of root-level secrets creates a straightforward and reliable path to full system compromise.</p>
        
        <hr>

        <div class="footer">
            <p><strong>Report prepared by:</strong> Security Assessment Team<br>
            <strong>Date:</strong> May 03, 2025</p>
            <p>CONFIDENTIAL - For educational purposes only</p>
        </div>

    </div>

</body>
</html>