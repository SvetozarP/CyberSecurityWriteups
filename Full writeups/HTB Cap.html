<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Penetration Testing Report - Cap</title>
    <style>
        /* --- Universal Styles for Screen and Print --- */
        body {
            background-color: #0a4b63; /* Dark Teal Background */
            color: #f0f0f0; /* Off-white text for readability */
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 0;
            /* ** Crucial for forcing background colors in print ** */
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
        }
        .container {
            max-width: 900px;
            margin: 40px auto;
            padding: 20px 40px;
            background-color: #0c5975;
            border-radius: 8px;
            box-shadow: 0 0 15px rgba(0,0,0,0.5);
        }
        h1, h2, h3, h4 {
            color: #ffffff;
            border-bottom: 1px solid #2a9d8f;
            padding-bottom: 10px;
        }
        h1 {
            text-align: center;
            font-size: 2.5em;
            padding: 20px 0;
            border-top: 3px solid #93c47d; /* Green accent line */
            border-bottom: 3px solid #93c47d; /* Green accent line */
            margin-bottom: 5px;
        }
        h2.subtitle {
             text-align: center;
             font-size: 1.8em;
             border: none;
             margin-top: 0;
             margin-bottom: 5px;
        }
        h3.report-meta {
            text-align: center;
            font-size: 1.2em;
            border: none;
            margin-top: 0;
            margin-bottom: 5px;
        }
        hr {
            border: 0;
            height: 1px;
            background-color: #2a9d8f;
            margin: 30px 0;
        }
        .confidential {
            text-align: center;
            margin: 20px 0;
        }
        .confidential strong {
            font-size: 1.1em;
        }
        .confidential em {
            font-size: 0.9em;
            color: #cccccc;
        }
        a {
            color: #93c47d; /* Green accent for links */
            text-decoration: none;
        }
        a:hover {
            text-decoration: underline;
        }
        ul, ol {
            padding-left: 20px;
        }
        li {
            margin-bottom: 10px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 25px 0;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border: 1px solid #1a7469;
        }
        thead {
            background-color: #93c47d; /* Green accent for table headers */
            color: #0a4b63;
            /* ** Crucial for forcing background colors in print ** */
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
        }
        thead th {
             font-weight: bold;
        }
        tbody tr:nth-child(even) {
            background-color: #0a4b63; /* Striped rows */
        }
        pre {
            background-color: #002b36; /* Darker background for code */
            color: #cddc39; /* Lime green text for code */
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            border: 1px solid #1a7469;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        code {
            font-family: 'Courier New', Courier, monospace;
        }
        .footer {
             text-align: center;
             margin-top: 40px;
             font-style: italic;
             color: #cccccc;
        }
        
        /* This rule helps control the margins set by the browser's print function */
        @page {
            margin: 0.75in;
        }

    </style>
</head>
<body>

    <div class="container">

        <h1>CAPTURE THE FLAG PENETRATION TESTING</h1>
        <h2 class="subtitle">Report of Findings: Cap</h2>
        <h3 class="report-meta">Date: January 6, 2025</h3>
        <h3 class="report-meta">Version: 1.0</h3>

        <div class="confidential">
            <strong>CONFIDENTIAL</strong><br>
            <em>For educational and training purposes only</em>
        </div>

        <hr>
        
        <h2 id="table-of-contents">TABLE OF CONTENTS</h2>
        <ol>
            <li><a href="#executive-summary">Executive Summary</a></li>
            <li><a href="#technical-summary">Technical Summary</a></li>
            <li><a href="#detailed-findings">Detailed Technical Findings</a></li>
            <li><a href="#attack-timeline">Attack Timeline</a></li>
            <li><a href="#port-scan">Port Scan Results</a></li>
            <li><a href="#network-analysis">Network Analysis</a></li>
            <li><a href="#remediation">Remediation Recommendations</a></li>
            <li><a href="#evidence">Evidence Files</a></li>
            <li><a href="#conclusion">Conclusion</a></li>
        </ol>

        <hr>

        <h2 id="executive-summary">EXECUTIVE SUMMARY</h2>
        <p>This penetration test was conducted against the HTB Cap machine (10.10.10.245) on January 6, 2025, using a black-box approach. The assessment successfully identified and exploited critical vulnerabilities leading to complete system compromise through information disclosure and privilege escalation.</p>
        
        <h3>Key Findings Summary</h3>
        <ul>
            <li><strong>3 security vulnerabilities</strong> identified</li>
            <li><strong>Complete system compromise</strong> achieved</li>
            <li><strong>Critical information disclosure</strong> via insecure web application</li>
            <li><strong>Privilege escalation</strong> via CVE-2021-4034 (PwnKit)</li>
            <li><strong>Credential exposure</strong> through network packet capture analysis</li>
        </ul>

        <h3>Risk Level: HIGH</h3>
        <p>The target system contains critical vulnerabilities that allow for credential harvesting and privilege escalation, leading to complete system compromise.</p>

        <hr>

        <h2 id="technical-summary">TECHNICAL SUMMARY</h2>
        
        <h3>Target Information</h3>
        <ul>
            <li><strong>Target IP:</strong> 10.10.10.245</li>
            <li><strong>Attacker IP:</strong> 10.10.14.134</li>
            <li><strong>Operating System:</strong> Ubuntu Linux (5.4.0-80-generic)</li>
            <li><strong>Hostname:</strong> cap</li>
        </ul>

        <h3>Attack Vector Summary</h3>
        <ol>
            <li><strong>Initial Access:</strong> Web application information disclosure via PCAP file download</li>
            <li><strong>Credential Harvesting:</strong> Network packet analysis revealing SSH credentials</li>
            <li><strong>Privilege Escalation:</strong> CVE-2021-4034 (PwnKit) exploitation</li>
        </ol>

        <hr>

        <h2 id="detailed-findings">DETAILED TECHNICAL FINDINGS</h2>

        <h3>Finding 1: Insecure Direct Object Reference (IDOR) Leading to Information Disclosure</h3>
        <p><strong>Severity:</strong> CRITICAL<br>
        <strong>CVSS Score:</strong> 9.3<br>
        <strong>CWE:</strong> CWE-200 (Information Exposure)</p>
        <p><strong>Description:</strong><br>
        The web application allows unauthorized access to sensitive network capture files through predictable URL parameters. The application exposes a security dashboard that permits downloading PCAP files containing network traffic, including sensitive authentication data.</p>
        <p><strong>Technical Details:</strong></p>
        <ul>
            <li><strong>Vulnerable Endpoint:</strong> <code>/data/id</code> where <code>id</code> is a numeric parameter</li>
            <li><strong>Method:</strong> Direct URL manipulation to access PCAP files</li>
            <li><strong>Information Disclosed:</strong> Network packet captures containing authentication credentials</li>
        </ul>
        <p><strong>Evidence:</strong></p>
        <ul>
            <li>Security dashboard accessible at <code>http://10.10.10.245/</code></li>
            <li>User interface shows "Nathan" as authenticated user</li>
            <li>Network statistics displayed:
                <ul>
                    <li>Security Events: 1560 (+1%)</li>
                    <li>Failed Login Attempts: 357 (0%)</li>
                    <li>Port Scan (Nmap) [PA]: 27 (-8%)</li>
                </ul>
            </li>
        </ul>
        <p><strong>Exploitation:</strong></p>
        <pre><code>GET /data/0 HTTP/1.1
Host: 10.10.10.245</code></pre>
        <p><strong>Impact:</strong> Complete credential exposure through network packet analysis, leading to system compromise.</p>

        <h3>Finding 2: Credential Exposure in Network Captures</h3>
        <p><strong>Severity:</strong> HIGH<br>
        <strong>CVSS Score:</strong> 8.5<br>
        <strong>CWE:</strong> CWE-522 (Insufficiently Protected Credentials)</p>
        <p><strong>Description:</strong><br>
        Network packet capture files contain unencrypted authentication credentials transmitted in clear text, allowing attackers to extract valid user credentials for system access.</p>
        <p><strong>Technical Details:</strong></p>
        <ul>
            <li><strong>Credential Discovery Method:</strong> Wireshark analysis of downloaded PCAP files</li>
            <li><strong>Protocol:</strong> FTP authentication (clear text transmission)</li>
            <li><strong>Credentials Found:</strong> nathan:Buck3tH4TF0RM3!</li>
        </ul>
        <p><strong>Evidence:</strong><br>
        PCAP analysis revealed FTP authentication sequence:</p>
        <ul>
            <li>Source: 192.168.196.16</li>
            <li>Destination: 192.168.196.1</li>
            <li>Protocol: FTP</li>
            <li>Authentication visible in clear text</li>
        </ul>
        <p><strong>Impact:</strong> Valid SSH credentials obtained, allowing authenticated access to the target system.</p>

        <h3>Finding 3: Linux Privilege Escalation via CVE-2021-4034 (PwnKit)</h3>
        <p><strong>Severity:</strong> HIGH<br>
        <strong>CVSS Score:</strong> 7.8<br>
        <strong>CWE:</strong> CWE-269 (Improper Privilege Management)</p>
        <p><strong>Description:</strong><br>
        The system is vulnerable to CVE-2021-4034 (PwnKit), a local privilege escalation vulnerability in the PolicyKit's pkexec utility that allows any local user to gain root privileges.</p>
        <p><strong>Technical Details:</strong></p>
        <ul>
            <li><strong>Vulnerable Component:</strong> pkexec (PolicyKit)</li>
            <li><strong>CVE:</strong> CVE-2021-4034</li>
            <li><strong>Exploitation Method:</strong> Memory corruption in pkexec leading to arbitrary code execution as root</li>
            <li><strong>System Version:</strong> Ubuntu 20.04 with vulnerable pkexec version</li>
        </ul>
        <p><strong>Evidence:</strong></p>
        <pre><code>nathan@cap:~$ cat user.txt
bbc52ef71f0c86ca9e85ba9c562b0a99

nathan@cap:/tmp$ cd CVE-2021-4034/
nathan@cap:/tmp/CVE-2021-4034$ ls
cve-2021-4034.c  cve-2021-4034.sh  dry-run  pwnkit.c

nathan@cap:/tmp/CVE-2021-4034$ ./cve-2021-4034.sh
cc -Wall -shared -fPIC -o pwnkit.so pwnkit.c
cc -Wall -shared -fPIC -o pwnkit.so pwnkit.c
echo "module UTF-8// PWNKIT// pwnkit 1" > gconv-modules
mkdir -p GCONV_PATH=.
cp /usr/bin/true /tmp/CVE-2021-4034/
./pwnkit

uid=0(root) gid=0(root) groups=0(root),1001(nathan)

# cat root.txt
f39fd13223da75f94c639066d79b63c0</code></pre>
        <p><strong>Impact:</strong> Complete privilege escalation from standard user to root, leading to full system compromise.</p>

        <hr>

        <h2 id="attack-timeline">ATTACK TIMELINE</h2>
        
        <h3>Phase 1: Reconnaissance (19:52 GMT)</h3>
        <ul>
            <li><strong>Network Scan:</strong> Identified open services on target</li>
            <li><strong>Port Enumeration:</strong> Discovered HTTP service on port 80</li>
            <li><strong>Service Analysis:</strong> Found security dashboard web application</li>
        </ul>

        <h3>Phase 2: Web Application Analysis (19:55 GMT)</h3>
        <ul>
            <li><strong>Dashboard Access:</strong> Identified security monitoring interface</li>
            <li><strong>IDOR Discovery:</strong> Found vulnerable <code>/data/id</code> endpoint</li>
            <li><strong>File Enumeration:</strong> Attempted access to various data files</li>
        </ul>
        
        <h3>Phase 3: Information Disclosure (20:10 GMT)</h3>
        <ul>
            <li><strong>PCAP Download:</strong> Successfully retrieved network capture file via <code>/data/0</code></li>
            <li><strong>Packet Analysis:</strong> Analyzed network traffic using Wireshark</li>
            <li><strong>Credential Extraction:</strong> Discovered FTP credentials nathan:Buck3tH4TF0RM3!</li>
        </ul>

        <h3>Phase 4: Initial Access (20:15 GMT)</h3>
        <ul>
            <li><strong>SSH Authentication:</strong> Successfully logged in using discovered credentials</li>
            <li><strong>User Flag:</strong> Retrieved user.txt (bbc52ef71f0c86ca9e85ba9c562b0a99)</li>
            <li><strong>System Enumeration:</strong> Performed privilege escalation reconnaissance</li>
        </ul>

        <h3>Phase 5: Privilege Escalation (20:30 GMT)</h3>
        <ul>
            <li><strong>Vulnerability Research:</strong> Identified system vulnerable to CVE-2021-4034</li>
            <li><strong>Exploit Preparation:</strong> Downloaded and compiled PwnKit exploit</li>
            <li><strong>Root Access:</strong> Successfully escalated to root privileges</li>
            <li><strong>Root Flag:</strong> Retrieved root.txt (f39fd13223da75f94c639066d79b63c0)</li>
        </ul>

        <hr>
        
        <h2 id="port-scan">PORT SCAN RESULTS</h2>
        <h3>TCP Port Scan</h3>
        <pre><code>Starting Nmap 7.95 ( https://nmap.org )
Nmap scan report for 10.10.10.245
Host is up (0.084s latency).

PORT      STATE SERVICE VERSION
22/tcp    open  ssh     OpenSSH 8.9p1 Ubuntu 3ubuntu0.4 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey:
|   256 3e:ea:45:4b:c5:d1:6d:6f:e2:d4:d1:3b:0a:3d:a9:4f (ECDSA)
|_  256 64:cc:75:de:4a:e6:a5:b4:73:eb:3f:1b:cf:b4:e3:94 (ED25519)
21/tcp    open  ftp     vsftpd 3.0.3
80/tcp    open  http    gunicorn
|_http-title: Security Dashboard
|_http-server-header: gunicorn

Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</code></pre>
        <h3>UDP Port Scan</h3>
        <pre><code>All 65535 scanned ports on 10.10.10.245 are in ignored states.
Not shown: 65164 open|filtered udp ports (no-response), 300 closed udp ports (port-unreach)</code></pre>
        <p><strong>Key Services:</strong></p>
        <ul>
            <li><strong>SSH (22/tcp):</strong> OpenSSH 8.9p1 Ubuntu</li>
            <li><strong>FTP (21/tcp):</strong> vsftpd 3.0.3 (no anonymous access)</li>
            <li><strong>HTTP (80/tcp):</strong> Python gunicorn web server hosting security dashboard</li>
        </ul>

        <hr>

        <h2 id="network-analysis">NETWORK ANALYSIS</h2>
        <h3>System Information from Dashboard</h3>
        <pre><code>eth0: flags=4163<UP,BROADCAST,RUNNING,MULTICAST> mtu 1500
      inet 10.10.10.245 netmask 255.255.255.0 broadcast 10.10.10.255
      inet6 dead:beef::250:56ff:feb0:6f81 prefixlen 64 scopeid 0x0<global>
      inet6 fe80::250:56ff:feb0:6f81 prefixlen 64 scopeid 0x20<link>
      ether 00:50:56:b0:6f:81 txqueuelen 1000 (Ethernet)

lo: flags=73<UP,LOOPBACK,RUNNING> mtu 65536
    inet 127.0.0.1 netmask 255.0.0.0
    inet6 ::1 prefixlen 128 scopeid 0x10<host>
    loop txqueuelen 1000 (Local Loopback)</code></pre>
        <h3>Active Network Connections</h3>
        <p>The dashboard revealed multiple TIME_WAIT connections to various IP addresses, indicating active network monitoring and data collection capabilities.</p>

        <hr>

        <h2 id="remediation">REMEDIATION RECOMMENDATIONS</h2>
        
        <h3>CRITICAL PRIORITY</h3>
        <ol>
            <li><strong>Immediately patch PolicyKit</strong> to address CVE-2021-4034 (PwnKit)</li>
            <li><strong>Implement proper access controls</strong> for <code>/data/</code> endpoint with authentication</li>
            <li><strong>Remove or secure network capture files</strong> containing sensitive information</li>
            <li><strong>Change compromised credentials</strong> for user Nathan</li>
        </ol>

        <h3>HIGH PRIORITY</h3>
        <ol>
            <li><strong>Implement input validation</strong> for all web application parameters</li>
            <li><strong>Add authentication and authorization</strong> for sensitive dashboard functions</li>
            <li><strong>Encrypt network traffic</strong> containing authentication data</li>
            <li><strong>Regular security updates</strong> for all system components</li>
        </ol>

        <h3>MEDIUM PRIORITY</h3>
        <ol>
            <li><strong>Implement logging and monitoring</strong> for unauthorized access attempts</li>
            <li><strong>Network segmentation</strong> to isolate monitoring systems</li>
            <li><strong>Regular vulnerability scanning</strong> of web applications</li>
            <li><strong>Secure FTP configuration</strong> or replacement with secure alternatives</li>
        </ol>

        <h3>LONG TERM</h3>
        <ol>
            <li><strong>Security awareness training</strong> for development team</li>
            <li><strong>Secure coding practices</strong> implementation</li>
            <li><strong>Regular penetration testing</strong> to identify new vulnerabilities</li>
            <li><strong>Implement data loss prevention</strong> measures for sensitive information</li>
        </ol>

        <hr>

        <h2 id="evidence">EVIDENCE FILES</h2>
        
        <h3>User Flag</h3>
        <ul>
            <li><strong>Location:</strong> /home/nathan/user.txt</li>
            <li><strong>Value:</strong> bbc52ef71f0c86ca9e85ba9c562b0a99</li>
        </ul>

        <h3>Root Flag</h3>
        <ul>
            <li><strong>Location:</strong> /root/root.txt</li>
            <li><strong>Value:</strong> f39fd13223da75f94c639066d79b63c0</li>
        </ul>

        <h3>Network Capture Analysis</h3>
        <ul>
            <li><strong>Source File:</strong> /data/0 (PCAP format)</li>
            <li><strong>Analysis Tool:</strong> Wireshark</li>
            <li><strong>Credentials Found:</strong> nathan:Buck3tH4TF0RM3!</li>
            <li><strong>Protocol:</strong> FTP authentication</li>
        </ul>

        <h3>Privilege Escalation</h3>
        <ul>
            <li><strong>Exploit:</strong> CVE-2021-4034 (PwnKit)</li>
            <li><strong>Method:</strong> PolicyKit pkexec memory corruption</li>
            <li><strong>Result:</strong> uid=0(root) gid=0(root) groups=0(root),1001(nathan)</li>
        </ul>

        <hr>

        <h2 id="conclusion">CONCLUSION</h2>
        <p>The HTB Cap machine demonstrated critical security vulnerabilities in both web application design and system configuration. The primary attack vectors were an insecure direct object reference vulnerability allowing access to sensitive network captures, followed by privilege escalation through an unpatched system vulnerability.</p>
        <p>The engagement successfully demonstrated:</p>
        <ul>
            <li>Information disclosure through web application vulnerabilities</li>
            <li>Credential harvesting from network packet analysis</li>
            <li>Local privilege escalation to root access</li>
            <li>Complete system compromise</li>
        </ul>
        <p><strong>Business Risk:</strong> HIGH - Sensitive information exposure and complete system compromise possible through web application vulnerabilities.<br>
        <strong>Technical Risk:</strong> Critical information disclosure leading to credential compromise and full administrative access.</p>
        
        <hr>

        <div class="footer">
            <p><strong>Report prepared by:</strong> Security Assessment Team<br>
            <strong>Date:</strong> January 6, 2025</p>
            <p>CONFIDENTIAL - For educational purposes only</p>
        </div>

    </div>

</body>
</html>