<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Penetration Testing Report - Nocturnal</title>
    <style>
        /* --- Universal Styles for Screen and Print --- */
        body {
            background-color: #0a4b63; /* Dark Teal Background */
            color: #f0f0f0; /* Off-white text for readability */
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 0;
            /* ** Crucial for forcing background colors in print ** */
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
        }
        .container {
            max-width: 900px;
            margin: 40px auto;
            padding: 20px 40px;
            background-color: #0c5975;
            border-radius: 8px;
            box-shadow: 0 0 15px rgba(0,0,0,0.5);
        }
        h1, h2, h3, h4 {
            color: #ffffff;
            border-bottom: 1px solid #2a9d8f;
            padding-bottom: 10px;
        }
        h1 {
            text-align: center;
            font-size: 2.5em;
            padding: 20px 0;
            border-top: 3px solid #93c47d; /* Green accent line */
            border-bottom: 3px solid #93c47d; /* Green accent line */
            margin-bottom: 5px;
        }
        h2.subtitle {
             text-align: center;
             font-size: 1.8em;
             border: none;
             margin-top: 0;
             margin-bottom: 5px;
        }
        h3.report-meta {
            text-align: center;
            font-size: 1.2em;
            border: none;
            margin-top: 0;
            margin-bottom: 5px;
        }
        hr {
            border: 0;
            height: 1px;
            background-color: #2a9d8f;
            margin: 30px 0;
        }
        .confidential {
            text-align: center;
            margin: 20px 0;
        }
        .confidential strong {
            font-size: 1.1em;
        }
        .confidential em {
            font-size: 0.9em;
            color: #cccccc;
        }
        a {
            color: #93c47d; /* Green accent for links */
            text-decoration: none;
        }
        a:hover {
            text-decoration: underline;
        }
        ul, ol {
            padding-left: 20px;
        }
        li {
            margin-bottom: 10px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 25px 0;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border: 1px solid #1a7469;
        }
        thead {
            background-color: #93c47d; /* Green accent for table headers */
            color: #0a4b63;
            /* ** Crucial for forcing background colors in print ** */
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
        }
        thead th {
             font-weight: bold;
        }
        tbody tr:nth-child(even) {
            background-color: #0a4b63; /* Striped rows */
        }
        pre {
            background-color: #002b36; /* Darker background for code */
            color: #cddc39; /* Lime green text for code */
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            border: 1px solid #1a7469;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        code {
            font-family: 'Courier New', Courier, monospace;
        }
        .footer {
             text-align: center;
             margin-top: 40px;
             font-style: italic;
             color: #cccccc;
        }
        
        /* This rule helps control the margins set by the browser's print function */
        @page {
            margin: 0.75in;
        }

    </style>
</head>
<body>

    <div class="container">

        <h1>CAPTURE THE FLAG PENETRATION TESTING</h1>
        <h2 class="subtitle">Report of Findings: Nocturnal</h2>
        <h3 class="report-meta">Date: April 13, 2025</h3>
        <h3 class="report-meta">Version: 1.0</h3>

        <div class="confidential">
            <strong>CONFIDENTIAL</strong><br>
            <em>For educational and training purposes only</em>
        </div>

        <hr>
        
        <h2 id="table-of-contents">TABLE OF CONTENTS</h2>
        <ol>
            <li><a href="#executive-summary">Executive Summary</a></li>
            <li><a href="#technical-summary">Technical Summary</a></li>
            <li><a href="#detailed-findings">Detailed Technical Findings</a></li>
            <li><a href="#attack-timeline">Attack Timeline</a></li>
            <li><a href="#port-scan">Port Scan Results</a></li>
            <li><a href="#remediation">Remediation Recommendations</a></li>
            <li><a href="#evidence">Evidence Files</a></li>
            <li><a href="#conclusion">Conclusion</a></li>
        </ol>

        <hr>

        <h2 id="executive-summary">EXECUTIVE SUMMARY</h2>
        <p>This report details a penetration test on the HTB Nocturnal machine (10.10.11.64). The assessment uncovered a chain of high-risk vulnerabilities, beginning with a Local File Inclusion (LFI) vulnerability in a public-facing PHP application. This flaw was exploited to leak credentials, enabling lateral movement to an SSH-accessible user account. Privilege escalation was then achieved by exploiting a known authenticated Remote Code Execution (RCE) vulnerability in a locally running ISPConfig instance (CVE-2023-46818). This sequence of vulnerabilities allowed for a full system compromise from an unauthenticated starting position.</p>
        
        <h3>Key Findings Summary</h3>
        <ul>
            <li><strong>3 high-risk vulnerabilities</strong> were chained for a full compromise.</li>
            <li><strong>Complete system compromise</strong> from unauthenticated to root.</li>
            <li><strong>Local File Inclusion (LFI)</strong> with a null byte bypass, leading to credential disclosure.</li>
            <li><strong>Password Reuse</strong> across different services, enabling lateral movement.</li>
            <li><strong>Authenticated RCE in ISPConfig (CVE-2023-46818)</strong>, leading to root privileges.</li>
        </ul>

        <h3>Risk Level: HIGH</h3>
        <p>The system is exposed to a high risk of compromise. The combination of a classic web application vulnerability (LFI), poor credential management, and an unpatched, privileged local service provides a clear and repeatable path for an external attacker to gain full administrative control.</p>

        <hr>

        <h2 id="technical-summary">TECHNICAL SUMMARY</h2>
        
        <h3>Target Information</h3>
        <ul>
            <li><strong>Target IP:</strong> 10.10.11.64</li>
            <li><strong>Attacker IP:</strong> 10.10.14.12</li>
            <li><strong>Hostname:</strong> nocturnal.htb</li>
            <li><strong>Operating System:</strong> Ubuntu 20.04.6 LTS</li>
        </ul>

        <h3>Attack Vector Summary</h3>
        <ol>
            <li><strong>Initial Access:</strong> A Local File Inclusion (LFI) vulnerability was discovered in the `view.php` script. The application appended a `.doc` extension to the user-supplied filename, which was bypassed using a null byte (`%00`) injection. This was used to read `config.php`, revealing a temporary password for the user `amanda`.</li>
            <li><strong>Lateral Movement:</strong> After enumerating users from the internal database, it was discovered that the password for the `admin` user of the local ISPConfig instance was being reused for the system user `tobias`. This password (`slowmotionapocalypse`) was used to authenticate via SSH.</li>
            <li><strong>Privilege Escalation:</strong> The `tobias` user had access to a locally running ISPConfig panel on port 8080. This version of ISPConfig was vulnerable to an authenticated Remote Code Execution (RCE), CVE-2023-46818. A public exploit was used with the discovered admin credentials to execute commands as the root user.</li>
        </ol>

        <hr>

        <h2 id="detailed-findings">DETAILED TECHNICAL FINDINGS</h2>

        <h3>Finding 1: Local File Inclusion with Null Byte Bypass</h3>
        <p><strong>Severity:</strong> HIGH<br>
        <strong>CVSS Score:</strong> 7.5<br>
        <strong>CWE:</strong> CWE-22 (Improper Limitation of a Pathname to a Restricted Directory)</p>
        <p><strong>Description:</strong><br>
        The `view.php` script is vulnerable to Local File Inclusion. It takes a `username` and `file` parameter to display documents. The script attempts to restrict file access by appending a `.doc` extension to the `file` parameter. However, this defense is ineffective as the underlying PHP version is susceptible to null byte injection. By appending a null byte (`%00`) to the desired filename, an attacker can cause the PHP interpreter to terminate the string, ignoring the appended `.doc` extension. This allows for the reading of arbitrary files with a `.php` extension.</p>
        <p><strong>Technical Details:</strong></p>
        <ul>
            <li><strong>Vulnerable Script:</strong> `/view.php`</li>
            <li><strong>Bypass Technique:</strong> Null byte injection (`%00`).</li>
        </ul>
        <p><strong>Evidence:</strong><br>The following URL was used to read the contents of `config.php` and retrieve credentials:</p>
        <pre><code>http://nocturnal.htb/view.php?username=amanda&file=config.php%00.doc</code></pre>
        <p><strong>Impact:</strong> This vulnerability allowed for the disclosure of sensitive configuration files and user credentials, providing the necessary information for the next stage of the attack.</p>

        <h3>Finding 2: Insecure Password Reuse</h3>
        <p><strong>Severity:</strong> HIGH<br>
        <strong>CVSS Score:</strong> 7.8<br>
        <strong>CWE:</strong> CWE-255 (Credentials Management)</p>
        <p><strong>Description:</strong><br>
        After gaining access to the machine's internal database, the password for the `admin` user was discovered. This same password, `slowmotionapocalypse`, was found to be reused for the system user `tobias`. This insecure but common practice allowed the attacker to pivot from a limited web context to a full, interactive shell on the system via SSH.</p>
        <p><strong>Technical Details:</strong></p>
        <ul>
            <li><strong>Username:</strong> `tobias`</li>
            <li><strong>Reused Password:</strong> `slowmotionapocalypse`</li>
        </ul>
        <p><strong>Impact:</strong> Password reuse enabled lateral movement and privilege escalation from a web user to a system user with access to privileged local services, a critical step in the attack chain.</p>

        <h3>Finding 3: ISPConfig Authenticated RCE (CVE-2023-46818)</h3>
        <p><strong>Severity:</strong> HIGH<br>
        <strong>CVSS Score:</strong> 8.8<br>
        <strong>CWE:</strong> CWE-94 (Improper Control of Generation of Code - 'Code Injection')</p>
        <p><strong>Description:</strong><br>
        A locally running instance of ISPConfig was discovered on `127.0.0.1:8080`. This version is vulnerable to CVE-2023-46818, an authenticated PHP code injection vulnerability. An attacker with administrator credentials (obtained via password reuse) can exploit this flaw to execute arbitrary PHP code. Since ISPConfig runs with high privileges, this code execution occurs as the root user.</p>
        <p><strong>Technical Details:</strong></p>
        <ul>
            <li><strong>Vulnerable Service:</strong> ISPConfig (version prior to 3.2.11p1) on localhost:8080.</li>
            <li><strong>Exploitation:</strong> A Python exploit was used to log in and inject a reverse shell payload.</li>
        </ul>
        <p><strong>Evidence:</strong><br>The following command was executed on the victim machine to gain a root shell:</p>
        <pre><code>python3 exploit.py http://127.0.0.1:8080 admin slowmotionapocalypse</code></pre>
        <p><strong>Impact:</strong> This vulnerability provided a direct path from an authenticated user to full root privileges, resulting in a complete compromise of the system.</p>

        <hr>

        <h2 id="attack-timeline">ATTACK TIMELINE</h2>
        
        <h3>Phase 1: Reconnaissance</h3>
        <ul>
            <li><strong>Scanning:</strong> Identified SSH (22) and HTTP (80) services.</li>
            <li><strong>Web Enumeration:</strong> Found `login.php`, `register.php`, and `view.php` endpoints. Identified the username `amanda` through brute-force attempts on `view.php`.</li>
        </ul>

        <h3>Phase 2: Initial Access</h3>
        <ul>
            <li><strong>LFI Exploitation:</strong> Used a null byte injection in the `file` parameter of `view.php` to read `config.php`, revealing a temporary password for `amanda`.</li>
            <li><strong>Database Access:</strong> Used credentials found to access an internal database and dump user hashes.</li>
        </ul>
        
        <h3>Phase 3: Lateral Movement</h3>
        <ul>
            <li><strong>Credential Discovery:</strong> Identified the password `slowmotionapocalypse` for the `admin` user in the database.</li>
            <li><strong>Password Reuse:</strong> Successfully used the `admin` password to log in as the system user `tobias` via SSH.</li>
        </ul>

        <h3>Phase 4: Privilege Escalation</h3>
        <ul>
            <li><strong>Internal Enumeration:</strong> Discovered the ISPConfig service running on `127.0.0.1:8080`.</li>
            <li><strong>Vulnerability Exploitation:</strong> Used a public exploit for CVE-2023-46818 with the discovered credentials to achieve remote code execution as root.</li>
            <li><strong>Root Access:</strong> Gained a root shell and retrieved the root flag.</li>
        </ul>

        <hr>
        
        <h2 id="port-scan">PORT SCAN RESULTS</h2>
        <h3>TCP Port Scan</h3>
        <pre><code>PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.12
80/tcp open  http    nginx 1.18.0 (Ubuntu)</code></pre>

        <hr>
        
        <h2 id="remediation">REMEDIATION RECOMMENDATIONS</h2>
        
        <h3>HIGH PRIORITY</h3>
        <ol>
            <li><strong>Patch ISPConfig:</strong> Immediately update the ISPConfig instance to version 3.2.11p1 or later to mitigate CVE-2023-46818.</li>
            <li><strong>Fix LFI Vulnerability:</strong> The `view.php` script must be rewritten to prevent file inclusion. Use a whitelist of allowed files instead of accepting arbitrary user input. Update the PHP version to one that is not vulnerable to null byte injection (PHP 5.3.4 and later).</li>
            <li><strong>Enforce Password Policy:</strong> Implement a strict password policy that prohibits password reuse across different applications and systems. Invalidate all current user passwords and require users to set new, unique ones.</li>
        </ol>

        <h3>MEDIUM PRIORITY</h3>
        <ol>
            <li><strong>Principle of Least Privilege:</strong> Review all user privileges. The web application should not be able to access sensitive configuration files. The `tobias` user should not have administrative access to ISPConfig unless required.</li>
            <li><strong>Regular Vulnerability Scanning:</strong> Implement a process for regularly scanning both external and internal services for known vulnerabilities to ensure they are patched in a timely manner.</li>
        </ol>

        <hr>

        <h2 id="evidence">EVIDENCE FILES</h2>
        
        <h3>User Flag</h3>
        <ul>
            <li><strong>Location:</strong> /home/tobias/user.txt</li>
            <li><strong>Value:</strong> c0c56fede2dd63b3fe981d8ab0f92055</li>
        </ul>

        <h3>Root Flag</h3>
        <ul>
            <li><strong>Location:</strong> /root/root.txt</li>
            <li><strong>Value:</strong> 20a6d476d3583f696e511d1dc4ab3db6</li>
        </ul>

        <h3>Key Artifacts</h3>
        <ul>
            <li><strong>LFI Payload:</strong> `config.php%00.doc`</li>
            <li><strong>User Password:</strong> `slowmotionapocalypse`</li>
            <li><strong>Privilege Escalation CVE:</strong> CVE-2023-46818</li>
        </ul>

        <hr>

        <h2 id="conclusion">CONCLUSION</h2>
        <p>The Nocturnal machine was compromised due to a chain of classic, high-impact vulnerabilities. The initial entry point was a Local File Inclusion flaw, a common but severe web application vulnerability. The path to privilege escalation was facilitated by poor password management practices (password reuse) and the failure to patch a known critical vulnerability in a privileged, internally-facing service. This engagement demonstrates the importance of a defense-in-depth approach, which includes secure coding, strong credential policies, and diligent patch management for all software components, both internal and external.</p>
        
        <p><strong>Business Risk:</strong> HIGH - The presence of a web application vulnerability that leads to credential disclosure, combined with an unpatched internal service, creates a high likelihood of a full system compromise by a determined attacker. This could lead to a complete loss of data confidentiality and integrity.</p>
        <p><strong>Technical Risk:</strong> The combination of LFI, password reuse, and a known authenticated RCE vulnerability in a privileged service creates a clear and repeatable path for an attacker to escalate from an unauthenticated position to full root access.</p>
        
        <hr>

        <div class="footer">
            <p><strong>Report prepared by:</strong> Security Assessment Team<br>
            <strong>Date:</strong> April 13, 2025</p>
            <p>CONFIDENTIAL - For educational purposes only</p>
        </div>

    </div>

</body>
</html>