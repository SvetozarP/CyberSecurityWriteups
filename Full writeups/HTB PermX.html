<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Penetration Testing Report - PermX</title>
    <style>
        /* --- Universal Styles for Screen and Print --- */
        body {
            background-color: #0a4b63; /* Dark Teal Background */
            color: #f0f0f0; /* Off-white text for readability */
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 0;
            /* ** Crucial for forcing background colors in print ** */
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
        }
        .container {
            max-width: 900px;
            margin: 40px auto;
            padding: 20px 40px;
            background-color: #0c5975;
            border-radius: 8px;
            box-shadow: 0 0 15px rgba(0,0,0,0.5);
        }
        h1, h2, h3, h4 {
            color: #ffffff;
            border-bottom: 1px solid #2a9d8f;
            padding-bottom: 10px;
        }
        h1 {
            text-align: center;
            font-size: 2.5em;
            padding: 20px 0;
            border-top: 3px solid #93c47d; /* Green accent line */
            border-bottom: 3px solid #93c47d; /* Green accent line */
            margin-bottom: 5px;
        }
        h2.subtitle {
             text-align: center;
             font-size: 1.8em;
             border: none;
             margin-top: 0;
             margin-bottom: 5px;
        }
        h3.report-meta {
            text-align: center;
            font-size: 1.2em;
            border: none;
            margin-top: 0;
            margin-bottom: 5px;
        }
        hr {
            border: 0;
            height: 1px;
            background-color: #2a9d8f;
            margin: 30px 0;
        }
        .confidential {
            text-align: center;
            margin: 20px 0;
        }
        .confidential strong {
            font-size: 1.1em;
        }
        .confidential em {
            font-size: 0.9em;
            color: #cccccc;
        }
        a {
            color: #93c47d; /* Green accent for links */
            text-decoration: none;
        }
        a:hover {
            text-decoration: underline;
        }
        ul, ol {
            padding-left: 20px;
        }
        li {
            margin-bottom: 10px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 25px 0;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border: 1px solid #1a7469;
        }
        thead {
            background-color: #93c47d; /* Green accent for table headers */
            color: #0a4b63;
            /* ** Crucial for forcing background colors in print ** */
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
        }
        thead th {
             font-weight: bold;
        }
        tbody tr:nth-child(even) {
            background-color: #0a4b63; /* Striped rows */
        }
        pre {
            background-color: #002b36; /* Darker background for code */
            color: #cddc39; /* Lime green text for code */
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            border: 1px solid #1a7469;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        code {
            font-family: 'Courier New', Courier, monospace;
        }
        .footer {
             text-align: center;
             margin-top: 40px;
             font-style: italic;
             color: #cccccc;
        }
        
        /* This rule helps control the margins set by the browser's print function */
        @page {
            margin: 0.75in;
        }

    </style>
</head>
<body>

    <div class="container">

        <h1>CAPTURE THE FLAG PENETRATION TESTING</h1>
        <h2 class="subtitle">Report of Findings: PermX</h2>
        <h3 class="report-meta">Date: January 26, 2025</h3>
        <h3 class="report-meta">Version: 1.0</h3>

        <div class="confidential">
            <strong>CONFIDENTIAL</strong><br>
            <em>For educational and training purposes only</em>
        </div>

        <hr>
        
        <h2 id="table-of-contents">TABLE OF CONTENTS</h2>
        <ol>
            <li><a href="#executive-summary">Executive Summary</a></li>
            <li><a href="#technical-summary">Technical Summary</a></li>
            <li><a href="#detailed-findings">Detailed Technical Findings</a></li>
            <li><a href="#attack-timeline">Attack Timeline</a></li>
            <li><a href="#port-scan">Port Scan Results</a></li>
            <li><a href="#remediation">Remediation Recommendations</a></li>
            <li><a href="#conclusion">Conclusion</a></li>
        </ol>

        <hr>

        <h2 id="executive-summary">EXECUTIVE SUMMARY</h2>
        <p>This report details the findings of a penetration test on the HTB PermX machine (10.10.11.23). The assessment uncovered a chain of high-risk vulnerabilities, starting with an unauthenticated Remote Code Execution (RCE) vulnerability in an outdated Chamilo LMS instance (CVE-2023-4220). This provided initial access to the system. Subsequent lateral movement was achieved by discovering database credentials in a configuration file and reusing them for an SSH-accessible user. Finally, privilege escalation to root was accomplished by exploiting a logic flaw in a custom script with `sudo` permissions, leading to a full system compromise.</p>
        
        <h3>Key Findings Summary</h3>
        <ul>
            <li><strong>3 high-risk vulnerabilities</strong> chained for complete system compromise.</li>
            <li><strong>Unauthenticated RCE in Chamilo LMS (CVE-2023-4220)</strong> via unrestricted file upload.</li>
            <li><strong>Credential Exposure</strong> in a configuration file, enabling password reuse for lateral movement.</li>
            <li><strong>Privilege Escalation</strong> through symlink abuse and a flawed sudo-privileged script.</li>
        </ul>

        <h3>Risk Level: HIGH</h3>
        <p>The system is exposed to a high risk of compromise. The combination of a public-facing RCE on an outdated application, poor credential management, and an insecurely configured administrative script provides a clear and effective path for an unauthenticated attacker to gain full administrative control.</p>

        <hr>

        <h2 id="technical-summary">TECHNICAL SUMMARY</h2>
        
        <h3>Target Information</h3>
        <ul>
            <li><strong>Target IP:</strong> 10.10.11.23</li>
            <li><strong>Attacker IP:</strong> 10.10.14.18</li>
            <li><strong>Hostnames:</strong> permx.htb, lms.permx.htb</li>
            <li><strong>Operating System:</strong> Ubuntu 22.04.4 LTS</li>
        </ul>

        <h3>Attack Vector Summary</h3>
        <ol>
            <li><strong>Initial Access:</strong> A subdomain, `lms.permx.htb`, was found to be running a vulnerable version of Chamilo LMS (1.11.24). The unauthenticated file upload vulnerability CVE-2023-4220 was exploited using a public script to upload a web shell and gain a reverse shell as the `www-data` user.</li>
            <li><strong>Lateral Movement:</strong> The `configuration.php` file for the Chamilo application was found to contain plaintext database credentials. The password was discovered to be reused for the system user `mtz`, allowing for a successful SSH login.</li>
            <li><strong>Privilege Escalation:</strong> The `mtz` user had passwordless `sudo` access to a script, `/opt/acl.sh`, which sets file ACLs. The script's path validation was flawed and could be bypassed with a symbolic link. A symlink was created in the user's home directory pointing to `/etc/sudoers`. The script was then used to grant the `mtz` user write permissions to this symlink, effectively allowing modification of the `sudoers` file. A new rule was added to grant `mtz` full, passwordless sudo privileges, leading to a root shell.</li>
        </ol>

        <hr>

        <h2 id="detailed-findings">DETAILED TECHNICAL FINDINGS</h2>

        <h3>Finding 1: Chamilo LMS Unauthenticated RCE (CVE-2023-4220)</h3>
        <p><strong>Severity:</strong> HIGH<br>
        <strong>CVSS Score:</strong> 8.1<br>
        <strong>CWE:</strong> CWE-434 (Unrestricted Upload of File with Dangerous Type)</p>
        <p><strong>Description:</strong><br>
        The Chamilo LMS version 1.11.24 running on `lms.permx.htb` is vulnerable to CVE-2023-4220. The "big file upload" functionality in `bigUpload.php` allows an unauthenticated attacker to upload files of arbitrary type, including PHP web shells, to a web-accessible directory. This directly leads to Remote Code Execution.</p>
        <p><strong>Technical Details:</strong></p>
        <ul>
            <li><strong>Vulnerable Component:</strong> Chamilo LMS 1.11.24 `bigUpload.php` script.</li>
            <li><strong>Exploitation:</strong> A public exploit script was used to upload a malicious payload and trigger a reverse shell.</li>
        </ul>
        <p><strong>Impact:</strong> This vulnerability allows an unauthenticated attacker to execute arbitrary code on the server with the privileges of the web server user (`www-data`), providing the initial foothold on the system.</p>

        <h3>Finding 2: Credential Exposure and Reuse</h3>
        <p><strong>Severity:</strong> HIGH<br>
        <strong>CVSS Score:</strong> 7.8<br>
        <strong>CWE:</strong> CWE-798 (Use of Hard-coded Credentials)</p>
        <p><strong>Description:</strong><br>
        After gaining initial access, the main configuration file for the Chamilo application was located at `/var/www/chamilo/config/configuration.php`. This file contained the database credentials in plaintext. The password was successfully reused to log in as the system user `mtz` via SSH.</p>
        <p><strong>Technical Details:</strong></p>
        <ul>
            <li><strong>Location of Credentials:</strong> `/var/www/chamilo/config/configuration.php`</li>
            <li><strong>Credentials Found:</strong> `chamilo`:`03F6lY3uXAP2bkW8`</li>
            <li><strong>Reused For:</strong> System user `mtz`</li>
        </ul>
        <p><strong>Impact:</strong> The insecure storage of plaintext credentials combined with password reuse allowed the attacker to pivot from a restricted web shell to an interactive user shell with `sudo` capabilities.</p>

        <h3>Finding 3: Privilege Escalation via Sudo Script and Symlink Bypass</h3>
        <p><strong>Severity:</strong> HIGH<br>
        <strong>CVSS Score:</strong> 7.8<br>
        <strong>CWE:</strong> CWE-59 (Improper Link Resolution Before File Access - 'Link Following')</p>
        <p><strong>Description:</strong><br>
        The user `mtz` has `NOPASSWD` sudo privileges to execute the `/opt/acl.sh` script. This script is designed to set file access control lists (ACLs) but contains a security flaw in its path validation. It attempts to restrict the target file to the `/home/mtz/` directory, but this check can be bypassed using a symbolic link. An attacker can create a symlink within `/home/mtz/` that points to a sensitive system file, such as `/etc/sudoers`. When the script is run against this symlink, it applies the permissions to the actual `sudoers` file, allowing the attacker to grant themselves unrestricted root access.</p>
        <p><strong>Technical Details:</strong></p>
        <ul>
            <li><strong>Vulnerable Component:</strong> Sudo rule for `/opt/acl.sh`.</li>
            <li><strong>Exploitation Steps:</strong>
                <ol>
                    <li>Create symlink: `ln -s /etc/sudoers /home/mtz/root`</li>
                    <li>Run script to gain write access: `sudo /opt/acl.sh mtz rw /home/mtz/root`</li>
                    <li>Append new rule to the symlink: `echo "mtz ALL=(ALL:ALL) NOPASSWD: ALL" >> /home/mtz/root`</li>
                    <li>Escalate to root: `sudo bash`</li>
                </ol>
            </li>
        </ul>
        <p><strong>Impact:</strong> This misconfiguration allows a standard user to gain full control over the `sudoers` file, which is a direct and reliable path to obtaining root privileges and achieving full system compromise.</p>

        <hr>

        <h2 id="attack-timeline">ATTACK TIMELINE</h2>
        
        <h3>Phase 1: Reconnaissance</h3>
        <ul>
            <li><strong>Scanning:</strong> Identified HTTP on port 80 and SSH on port 22.</li>
            <li><strong>Subdomain Enumeration:</strong> Discovered the `lms.permx.htb` subdomain running Chamilo LMS.</li>
            <li><strong>Version Identification:</strong> Identified the Chamilo version as 1.11.24 from the `license.txt` file.</li>
        </ul>

        <h3>Phase 2: Initial Access</h3>
        <ul>
            <li><strong>Vulnerability Exploitation:</strong> Used a public exploit for CVE-2023-4220 to gain a reverse shell as the `www-data` user.</li>
        </ul>
        
        <h3>Phase 3: Lateral Movement</h3>
        <ul>
            <li><strong>Internal Enumeration:</strong> Found the Chamilo `configuration.php` file and extracted database credentials.</li>
            <li><strong>Password Reuse:</strong> Successfully used the database password for the user `mtz` to log in via SSH.</li>
        </ul>

        <h3>Phase 4: Privilege Escalation</h3>
        <ul>
            <li><strong>Sudo Enumeration:</strong> Ran `sudo -l` to discover the privileged `acl.sh` script.</li>
            <li><strong>Logic Flaw Abuse:</strong> Created a symbolic link to `/etc/sudoers` to bypass the script's path validation.</li>
            <li><strong>Sudoers Modification:</strong> Used the script to gain write access to the `sudoers` file and added a rule for full privileges.</li>
            <li><strong>Root Access:</strong> Executed `sudo bash` to gain a root shell.</li>
        </ul>

        <hr>
        
        <h2 id="port-scan">PORT SCAN RESULTS</h2>
        <h3>TCP Port Scan</h3>
        <pre><code>PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 8.9p1 Ubuntu 3ubuntu0.10
80/tcp open  http    Apache httpd 2.4.52 (Ubuntu)</code></pre>

        <hr>
        
        <h2 id="remediation">REMEDIATION RECOMMENDATIONS</h2>
        
        <h3>HIGH PRIORITY</h3>
        <ol>
            <li><strong>Patch Chamilo LMS:</strong> Immediately update the Chamilo installation to the latest patched version to mitigate CVE-2023-4220 and other known vulnerabilities.</li>
            <li><strong>Fix Insecure Sudo Script:</strong> The `/opt/acl.sh` script is dangerously flawed. It should be rewritten to properly resolve the real path of a file (e.g., using `readlink -f`) before performing checks. Alternatively, the sudo rule should be removed entirely.</li>
            <li><strong>Enforce Strong Password Policies:</strong> Implement a strict password policy that prohibits password reuse across different services (database, system accounts, etc.). Invalidate all current user passwords and require them to be reset.</li>
        </ol>

        <h3>MEDIUM PRIORITY</h3>
        <ol>
            <li><strong>Credential Management:</strong> Do not store credentials in plaintext in configuration files. Use a secrets management solution or environment variables, and ensure file permissions are strictly controlled.</li>
            <li><strong>Principle of Least Privilege:</strong> Review all sudo rules. Users should only be granted the specific permissions required for their role. A rule allowing modification of arbitrary file permissions is too broad.</li>
        </ol>

        <hr>

        <h2 id="evidence">EVIDENCE FILES</h2>
        
        <h3>User Flag</h3>
        <ul>
            <li><strong>Location:</strong> /home/mtz/user.txt</li>
            <li><strong>Value:</strong> 373aa057d125a678e77512cb7752d507</li>
        </ul>

        <h3>Root Flag</h3>
        <ul>
            <li><strong>Location:</strong> /root/root.txt</li>
            <li><strong>Value:</strong> 2cba2afb930aeadff520760169f06909</li>
        </ul>

        <h3>Key Artifacts</h3>
        <ul>
            <li><strong>Chamilo Vulnerability:</strong> CVE-2023-4220</li>
            <li><strong>User Password:</strong> `03F6lY3uXAP2bkW8`</li>
            <li><strong>Privilege Escalation Vector:</strong> Sudo rule for `acl.sh` and symlink bypass.</li>
        </ul>

        <hr>

        <h2 id="conclusion">CONCLUSION</h2>
        <p>The PermX machine was compromised through a series of high-risk security flaws that demonstrate failures in patch management, credential management, and secure system administration. The initial entry point was a known, unpatched vulnerability in a public-facing application, highlighting the critical importance of keeping software up-to-date. The subsequent lateral movement and privilege escalation were made possible by classic but severe mistakes: storing credentials in plaintext, reusing passwords, and writing insecure privileged scripts. This engagement shows how multiple, distinct failures can be chained together by an attacker to achieve a full system compromise.</p>
        
        <p><strong>Business Risk:</strong> HIGH - The presence of a public RCE vulnerability creates a high likelihood that an attacker can gain initial access, leading to a full compromise through internal misconfigurations. This could result in a total loss of data confidentiality, integrity, and service availability.</p>
        <p><strong>Technical Risk:</strong> The combination of an unpatched application, password reuse, and a flawed sudo policy creates a clear and reliable path for an attacker to escalate from an unauthenticated position to full root access.</p>
        
        <hr>

        <div class="footer">
            <p><strong>Report prepared by:</strong> Security Assessment Team<br>
            <strong>Date:</strong> January 26, 2025</p>
            <p>CONFIDENTIAL - For educational purposes only</p>
        </div>

    </div>

</body>
</html>